<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <!-- 
      ุงูุชุนุฏูู 2: ุถุจุท ุงูููุงููุณ ูููุน ุงูุชูุฏุฏ ุงูุนุฑุถู ูู ุงูุฌูุงู
      ุชู ุงุณุชุจุฏุงู ุงููุณู ุงููุฏูู ุจูุฐุง ุงููุณู 
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุงุฏุงุฉ ุงูููุช ุงููุนูู - ุซุงูููุฉ ุฏุงุฑ ุงูุชูุญูุฏ</title>
    <!-- ุชุญููู Tailwind CSS ูููุงุฌูุฉ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ููุชุจุงุช ุชุตุฏูุฑ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ุฎุทูุท ุนุฑุจูุฉ ูุชุญุณูู ุงูุดูู */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
        }
        /* ูุฅุธูุงุฑ ุงูุชุญุฏูุฏ ุนูู ุงููุทุงุน ุงูุฏุงุฆุฑู */
        .sector-selected {
            stroke: #3b82f6; /* ููู ุฃุฒุฑู */
            stroke-width: 4px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        /* ุชูุณูู ูุฑุจุนุงุช ุงูููุช */
        .time-segment {
            transition: all 0.2s;
        }
        .time-segment-selected {
            background-color: #3b82f6; /* ุฃุฒุฑู */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.5);
        }
        /* ุชูุณูู ุฃุฒุฑุงุฑ ุฃุณููุจ ุงูุชุนูู */
        .style-btn {
            transition: all 0.2s;
        }
        .style-btn-selected {
            background-color: #10b981; /* ุฃุฎุถุฑ */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.5);
        }

        /* ุชูุณููุงุช ุงูุทุจุงุนุฉ */
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-card, #printable-card * {
                visibility: visible;
            }
            #printable-card {
                /* ุชู ุชุนุฏูู ูุฐู ุงููุงุนุฏุฉ ูุชูุณูุท ุงูุตูุญุฉ ุนูุฏ ุงูุทุจุงุนุฉ */
                /* position: absolute; */ /* ููุบู */
                /* left: 0; */ /* ููุบู */
                /* top: 0; */ /* ููุบู */
                width: 95%; /* ุชุญุฏูุฏ ุนุฑุถ ููุงุณุจ ููุทุจุงุนุฉ */
                margin: 1rem auto; /* ุชูุณูุท ุฃููู ูุน ูุงูุด ุนููู */
                padding: 0;
                border: none;
                box-shadow: none;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            #close-modal-btn, #print-modal-btn {
                display: none;
            }
            /* Ensure backgrounds print */
            #report-activity-bar, #report-quality-indicator, .bg-green-600 {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
        }
        
        /* ---
        ุงูุชุนุฏููุงุช ุงูููุชุฑุญุฉ ูุชุญุณูู ุนุฑุถ ุงูุฌูุงู
        --- */
        
        /* ุงูุชุนุฏูู 3: ุชุญุณูู ุงูุชูุงุนู ูุน ุงูุฃุฒุฑุงุฑ ุงูุตุบูุฑุฉ (ุฃูุฏุงู ุงูููุณ) */
        button, select, input {
            min-height: 44px; /* ุญุณุจ ูุนุงููุฑ ุงูููุณ ูู ุงูุฌูุงู */
        }
        
        /* ุงูุชุนุฏูู 5: ุฌุนู ูุตูุต ุงูุชูุฑูุฑ ูุงุจูุฉ ููุทู */
        #report-quality-text {
            white-space: normal; /* ุงูุณูุงุญ ุจุงูุทู ุงูุชููุงุฆู */
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* ุงูุชุนุฏูู 1 + 4: ููุงุนุฏ ุฎุงุตุฉ ุจุงูุดุงุดุงุช ุงูุตุบูุฑุฉ (ุงูุฌูุงู) */
        @media (max-width: 640px) {
            /* ุชุญุณูู ุนุฑุถ ุงููุงูุฐุฉ ุงูููุจุซูุฉ */
            #printable-card {
                width: 100%;
                max-height: 90vh; /* ุชุญุฏูุฏ ุฃูุตู ุงุฑุชูุงุน */
                overflow-y: auto; /* ุฅุถุงูุฉ ุชูุฑูุฑ ุฅุฐุง ูุงู ุงููุญุชูู ุทูููุงู */
                border-radius: 1rem; 
            }
            #report-modal {
                align-items: flex-start; /* ูุญุงุฐุงุฉ ููุจุฏุงูุฉ */
                padding-top: 2rem; /* ุชุฑู ูุณุงูุฉ ุนูููุฉ */
            }
            
            /* ุฅุตูุงุญ ุชุฏุงุฎู ุงูุฃุฒุฑุงุฑ (ูุซู ุฃุฒุฑุงุฑ ุฃุณููุจ ุงูุชุนูู ูุฃุฒุฑุงุฑ ุงูุชูุฑูุฑ) */
            .grid.grid-cols-2.gap-4 {
                grid-template-columns: 1fr; /* ุนููุฏ ูุงุญุฏ */
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">
        <header class="bg-green-600 text-white p-5">
            <div class="flex justify-center items-center gap-3">
                <!-- SVG Icon: Clipboard List -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                </svg>
                <h1 class="text-3xl font-bold text-center">ุงุฏุงุฉ ุงูููุช ุงููุนูู - ุซุงูููุฉ ุฏุงุฑ ุงูุชูุญูุฏ</h1>
            </div>
            <p class="text-lg text-center text-green-100 mt-1">ูุฏูุฑ ุงููุฏุฑุณุฉ: ููุฏ ุจู ุญุณู ุงููุญุทุงูู</p>
        </header>

        <main class="p-5 md:p-8">
            <!-- ูุณู ุฅุฏุฎุงู ุงูุจูุงูุงุช -->
            <form id="observation-form" class="space-y-5">
                
                <!-- ุดุจูุฉ ูุชุฑุชูุจ ุงูุญููู -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="teacher-name" class="block text-sm font-semibold text-gray-700 mb-1">ุงุณู ุงููุนูู</label>
                        <input type="text" id="teacher-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label for="subject" class="block text-sm font-semibold text-gray-700 mb-1">ุงููุงุฏุฉ</label>
                        <input type="text" id="subject" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label for="class-name" class="block text-sm font-semibold text-gray-700 mb-1">ุงููุตู</label>
                        <select id="class-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" required>
                            <option value="" disabled selected>ุงุฎุชุฑ ุงููุตู...</option>
                            <option value="101">101</option>
                            <option value="102">102</option>
                            <option value="103">103</option>
                            <option value="104">104</option>
                            <option value="201">201</option>
                            <option value="202">202</option>
                            <option value="203">203</option>
                            <option value="301">301</option>
                            <option value="302">302</option>
                        </select>
                    </div>
                    <div>
                        <label for="location" class="block text-sm font-semibold text-gray-700 mb-1">ููุงู ุงูุชูููุฐ</label>
                        <select id="location" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="ุงููุตู">ุงููุตู</option>
                            <option value="ูุงุนุฉ ุงูุชุฏุฑูุจ">ูุงุนุฉ ุงูุชุฏุฑูุจ</option>
                            <option value="ุงููุนูู">ุงููุนูู</option>
                            <option value="ุงููุฎุชุจุฑ">ุงููุฎุชุจุฑ</option>
                        </select>
                    </div>
                    <div class="md:col-span-1">
                        <label for="learning-event" class="block text-sm font-semibold text-gray-700 mb-1">ุงูุญุฏุซ ุงูุชุนูููู (ุฃุซูุงุก ุงูุฒูุงุฑุฉ)</label>
                        <select id="learning-event" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="ุนุฑุถ">ุนุฑุถ (ุดุฑุญ)</option>
                            <option value="ุงููุนูู ูููู ุงูุทูุงุจ ูุณุชูุนูู">ุงููุนูู ููููุ ุงูุทูุงุจ ูุณุชูุนูู</option>
                            <option value="ูุดุงุท ุตูู">ูุดุงุท ุตูู (ูุฑุฏู/ุฌูุงุนู)</option>
                            <option value="ููุงูุดุฉ ูุญูุงุฑ">ููุงูุดุฉ ูุญูุงุฑ</option>
                            <option value="ุชูููู">ุชูููู (ุงุฎุชุจุงุฑ/ุณุคุงู)</option>
                            <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                        </select>
                    </div>
                     <div class="md:col-span-1">
                        <label for="lesson-output" class="block text-sm font-semibold text-gray-700 mb-1">ูู ููุฌุฏ ูุฎุฑุฌุงุช ููุญุตุฉุ</label>
                        <select id="lesson-output" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="ูุง ููุฌุฏ">ูุง ููุฌุฏ</option>
                            <option value="ูุฑู ุนูู">ูุฑู ุนูู</option>
                            <option value="ุชุฌุฑุจุฉ">ุชุฌุฑุจุฉ</option>
                            <option value="ุนูู ุชุนุงููู">ุนูู ุชุนุงููู</option>
                            <option value="ุญู ูุณุฃูุฉ">ุญู ูุณุฃูุฉ</option>
                        </select>
                    </div>
                </div>

                <!-- ูุณู ููุช ุงูุญุตุฉ -->
                <div class="pt-4">
                    <label class="block text-lg font-semibold text-gray-800 mb-3 text-center">ุชูููุช ุงูุฑุตุฏ (ุจุงูุชุฑุงุถ ุงูุญุตุฉ 50 ุฏูููุฉ)</label>
                    <div class="grid grid-cols-5 gap-2">
                        <button type="button" class="time-segment text-sm md:text-base p-2 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุฏ 0-10">ุฏ 0-10</button>
                        <button type="button" class="time-segment text-sm md:text-base p-2 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุฏ 11-20">ุฏ 11-20</button>
                        <button type="button" class="time-segment text-sm md:text-base p-2 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุฏ 21-30">ุฏ 21-30</button>
                        <button type="button" class="time-segment text-sm md:text-base p-2 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุฏ 31-40">ุฏ 31-40</button>
                        <button type="button" class="time-segment text-sm md:text-base p-2 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุฏ 41-50">ุฏ 41-50</button>
                    </div>
                    <input type="hidden" id="time-segment-value" value="">
                </div>

                <!-- ูุณู ุฃุณููุจ ุงูุชุนูู -->
                <div class="pt-4">
                    <label class="block text-lg font-semibold text-gray-800 mb-3 text-center">ุฃุณููุจ ุงูุชุนูู</label>
                    <div class="grid grid-cols-2 gap-4">
                        <button type="button" class="style-btn p-3 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ูุดุท">
                            <span class="text-xl">๐</span> ูุดุท
                        </button>
                        <button type="button" class="style-btn p-3 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50" data-value="ุบูุฑ ูุดุท">
                            <span class="text-xl">๐</span> ุบูุฑ ูุดุท (ุชูููู)
                        </button>
                    </div>
                    <input type="hidden" id="learning-style-value" value="">
                </div>

                <!-- ูุณู ููุงุญุธุฉ ูุดุงุท ุงูุทูุงุจ -->
                <div class="pt-4">
                    <label class="block text-lg font-semibold text-gray-800 mb-3 text-center">ููุงุญุธุฉ ูุดุงุท ุงูุทูุงุจ (ุงููุฑ ููุงุฎุชูุงุฑ)</label>
                    <div class="flex justify-center">
                        <svg id="activity-wheel" width="300" height="300" viewBox="0 0 100 100" class="max-w-full h-auto">
                            <path id="sector-low" data-value="< 50%" 
                                  class="sector cursor-pointer transition-all duration-150 fill-red-500 hover:fill-red-600" 
                                  d="M50,50 L50,5 A45,45 0 0,1 88.97, 65.00 Z"></path>
                            <path id="sector-mid" data-value="50%" 
                                  class="sector cursor-pointer transition-all duration-150 fill-yellow-400 hover:fill-yellow-500" 
                                  d="M50,50 L88.97, 65.00 A45,45 0 0,1 11.03, 65.00 Z"></path>
                            <path id="sector-high" data-value="100%" 
                                  class="sector cursor-pointer transition-all duration-150 fill-green-500 hover:fill-green-600" 
                                  d="M50,50 L11.03, 65.00 A45,45 0 0,1 50,5 Z"></path>
                            <text x="75" y="45" class="fill-white font-bold text-sm pointer-events-none">&lt; 50%</text>
                            <text x="50" y="83" class="fill-white font-bold text-sm pointer-events-none" text-anchor="middle">50%</text>
                            <text x="25" y="45" class="fill-white font-bold text-sm pointer-events-none">100%</text>
                        </svg>
                    </div>
                    <input type="hidden" id="student-activity-value" value="">
                    <!-- ุฑุณุงูุฉ ุฎุทุฃ -->
                    <p id="error-message" class="text-red-500 text-center mt-2 h-5"></p>
                </div>

                <!-- ูุณู ููุงุญุธุงุช ุฅุถุงููุฉ -->
                <div class="pt-4">
                    <label class="block text-lg font-semibold text-gray-800 mb-3 text-center">ููุงุญุธุงุช ุฅุถุงููุฉ</label>

                    <div class="space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="negative-observation" class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="mr-3 text-gray-700">ุชู ููุงุญุธุฉ ุฎููู / ููู / ุนุจุซ ุจุงูุฃุฌูุฒุฉ</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="organized-env" class="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="mr-3 text-gray-700">ุงูุจูุฆุฉ ุงูุตููุฉ ููุธูุฉ</span>
                        </label>
                    </div>
                </div>


                <!-- ุฒุฑ ุงูุชุณุฌูู -->
                <div class="pt-4">
                    <button type="submit" id="log-button" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 text-lg">
                        ุชุณุฌูู ูุนุฑุถ ุงูุจุทุงูุฉ
                    </button>
                </div>
            </form>
        </main>
    </div>
    <footer class="text-center text-gray-500 text-sm mt-4">
        ููุฑุฉ ูุชุตููู: ูุญูุฏ ูุฌููู
    </footer>

    <!-- ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) ูุจุทุงูุฉ ุงูุชูุฑูุฑ -->
    <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <!-- ุงูุจุทุงูุฉ ุงููุงุจูุฉ ููุทุจุงุนุฉ -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-auto transform transition-all scale-95 opacity-0" id="printable-card">
            <!-- ุฑุฃุณ ุงูุจุทุงูุฉ -->
            <div class="bg-green-600 text-white p-5 rounded-t-xl">
                <h2 class="text-2xl font-bold text-center">ุจุทุงูุฉ ููุงุญุธุฉ ุตููุฉ</h2>
                <p class="text-center text-green-100">ุซุงูููุฉ ุฏุงุฑ ุงูุชูุญูุฏ</p>
            </div>
            
            <!-- ุฌุณู ุงูุจุทุงูุฉ -->
            <div class="p-6 space-y-4 divide-y divide-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-3 pb-4">
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ุงููุนูู:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-teacher"></p>
                    </div>
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ุงููุงุฏุฉ:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-subject"></p>
                    </div>
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ุงููุตู:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-class"></p>
                    </div>
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ุชูููุช ุงูุฒูุงุฑุฉ:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-time-segment"></p>
                    </div>
                     <div>
                        <span class="text-sm font-semibold text-gray-500">ุฃุณููุจ ุงูุชุนูู:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-style"></p>
                    </div>
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ุงูุญุฏุซ ุงูุชุนูููู:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-event"></p>
                    </div>
                    <div class="md:col-span-3">
                        <span class="text-sm font-semibold text-gray-500">ูุฎุฑุฌุงุช ุงูุญุตุฉ:</span>
                        <p class="text-lg font-bold text-gray-900" id="report-output"></p>
                    </div>
                </div>
                
                <!-- ูุณู ููุงุญุธุงุช ุฅุถุงููุฉ (ูู ุงูุจุทุงูุฉ) -->
                <div class="pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <div>
                        <span class="text-sm font-semibold text-gray-500">ุงูุจูุฆุฉ ุงูุตููุฉ:</span>
                        <p class="text-lg font-bold" id="report-organized-env"></p> <!-- ุณุชุชู ุชุนุจุฆุชูุง ุจู "ููุธูุฉ" ุฃู "ุบูุฑ ููุธูุฉ" -->
                    </div>
                    <div>
                        <span class="text-sm font-semibold text-gray-500">ููุงุญุธุงุช ุณูุจูุฉ (ุฎููู/ุนุจุซ):</span>
                        <p class="text-lg font-bold" id="report-negative-obs"></p> <!-- ุณุชุชู ุชุนุจุฆุชูุง ุจู "ูุนู" ุฃู "ูุง" -->
                    </div>
                </div>

                <!-- ูุณู ุงูุฑุณู ุงูุจูุงูู ููุดุงุท ุงูุทูุงุจ -->
                <div class="pt-4">
                    <span class="text-sm font-semibold text-gray-500">ูุณุชูู ูุดุงุท ุงูุทูุงุจ:</span>
                    <div class="flex items-center space-x-3" dir="ltr">
                        <div class="w-full bg-gray-200 rounded-full h-5 overflow-hidden">
                            <div id="report-activity-bar" class="h-5 rounded-full transition-all duration-500 ease-out"></div>
                        </div>
                        <span class="text-lg font-bold" id="report-activity-value"></span>
                    </div>
                </div>

                <!-- ูุณู ูุคุดุฑ ุฌูุฏุฉ ุงูุชูุงุนู (ุงูุงุญุตุงุฆูุฉ) -->
                <div class="pt-4">
                    <span class="text-sm font-semibold text-gray-500">ูุคุดุฑ ุฌูุฏุฉ ุงูุชูุงุนู:</span>
                    <div id="report-quality-indicator" class="p-3 rounded-lg mt-2">
                        <p id="report-quality-text" class="font-semibold text-center"></p>
                    </div>
                </div>

                <!-- ุฃุฒุฑุงุฑ ุงูุฅุบูุงู ูุงูุทุจุงุนุฉ -->
                <!-- 
                  ููุงุญุธุฉ: ุงููุงุนุฏุฉ ุงููุถุงูุฉ ูู CSS 
                  .grid.grid-cols-2.gap-4 { grid-template-columns: 1fr; } 
                  ุณุชุฌุนู ูุฐูู ุงูุฒุฑูู ูุธูุฑุงู ููู ุจุนุถููุง ูู ุงูุฌูุงู
                -->
                <div class="pt-4 grid grid-cols-2 gap-4">
                    <button id="print-modal-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300">
                        ุชุตุฏูุฑ PDF
                    </button>
                    <button id="close-modal-btn" class="w-full bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-300">
                        ุฅุบูุงู
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('observation-form');
            const errorMessage = document.getElementById('error-message');

            // ุนูุงุตุฑ ุงูุฏุงุฆุฑุฉ
            const sectors = document.querySelectorAll('.sector');
            const activityValueInput = document.getElementById('student-activity-value');

            // ุนูุงุตุฑ ูุฑุจุนุงุช ุงูููุช
            const timeSegments = document.querySelectorAll('.time-segment');
            const timeSegmentValueInput = document.getElementById('time-segment-value');

            // ุนูุงุตุฑ ุฃุณููุจ ุงูุชุนูู
            const styleButtons = document.querySelectorAll('.style-btn');
            const learningStyleInput = document.getElementById('learning-style-value');

            // ุนูุงุตุฑ ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal)
            const reportModal = document.getElementById('report-modal');
            const modalCard = document.getElementById('printable-card'); // ุงุณุชูุฏุงู ุงูุจุทุงูุฉ ุงููุงุจูุฉ ููุทุจุงุนุฉ
            const closeModalBtn = document.getElementById('close-modal-btn');
            const printModalBtn = document.getElementById('print-modal-btn');
            
            const reportTeacher = document.getElementById('report-teacher');
            const reportSubject = document.getElementById('report-subject');
            const reportClass = document.getElementById('report-class');
            const reportTimeSegment = document.getElementById('report-time-segment');
            const reportEvent = document.getElementById('report-event');
            const reportStyle = document.getElementById('report-style');
            const reportOutput = document.getElementById('report-output'); // ุงูุญูู ุงูุฌุฏูุฏ
            const reportActivityBar = document.getElementById('report-activity-bar');
            const reportActivityValue = document.getElementById('report-activity-value');
            const reportQualityIndicator = document.getElementById('report-quality-indicator');
            const reportQualityText = document.getElementById('report-quality-text');

            // ุนูุงุตุฑ ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ
            const negativeObsCheckbox = document.getElementById('negative-observation');
            const organizedEnvCheckbox = document.getElementById('organized-env');
            const reportOrganizedEnv = document.getElementById('report-organized-env');
            const reportNegativeObs = document.getElementById('report-negative-obs');


            // 1. ุงูุชุนุงูู ูุน ุงุฎุชูุงุฑ ุงููุทุงุน ุงูุฏุงุฆุฑู (ูุดุงุท ุงูุทูุงุจ)
            sectors.forEach(sector => {
                sector.addEventListener('click', (e) => {
                    sectors.forEach(s => s.classList.remove('sector-selected'));
                    const selectedSector = e.target.closest('.sector');
                    selectedSector.classList.add('sector-selected');
                    activityValueInput.value = selectedSector.dataset.value;
                    errorMessage.textContent = ''; 
                });
            });

            // 2. ุงูุชุนุงูู ูุน ุงุฎุชูุงุฑ ูุฑุจุนุงุช ุงูููุช
            timeSegments.forEach(segment => {
                segment.addEventListener('click', (e) => {
                    timeSegments.forEach(s => s.classList.remove('time-segment-selected'));
                    const selectedSegment = e.target.closest('.time-segment');
                    selectedSegment.classList.add('time-segment-selected');
                    timeSegmentValueInput.value = selectedSegment.dataset.value;
                    errorMessage.textContent = ''; 
                });
            });

            // 3. ุงูุชุนุงูู ูุน ุงุฎุชูุงุฑ ุฃุณููุจ ุงูุชุนูู
            styleButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    styleButtons.forEach(s => s.classList.remove('style-btn-selected'));
                    const selectedButton = e.target.closest('.style-btn');
                    selectedButton.classList.add('style-btn-selected');
                    learningStyleInput.value = selectedButton.dataset.value;
                    errorMessage.textContent = ''; 
                });
            });

            // ุฏุงูุฉ ุญุณุงุจ ุฌูุฏุฉ ุงูุชูุงุนู (ูุณุฎุฉ ูุทูุฑุฉ ูุฐููุฉ)
            function calculateQuality(activity, time, style, organized, negative, event) {
                const lateTime = (time === 'ุฏ 31-40' || time === 'ุฏ 41-50');
                const midTime = (time === 'ุฏ 21-30');
                const earlyTime = (time === 'ุฏ 0-10' || time === 'ุฏ 11-20');

                let messages = []; // ูุตูููุฉ ูุชุฌููุน ุงูููุงุญุธุงุช
                let color = 'yellow'; // ุงูููู ุงูุงูุชุฑุงุถู

                // 1. ุงูุชุญููู ุงูุฃุณุงุณู (ุงููุดุงุท ููุงุจู ุงูููุช)
                if (activity === '100%') {
                    if (lateTime) {
                        messages.push("ุชูุงุนู ููุชุงุฒ! ุงูุญูุงุธ ุนูู ุงููุดุงุท (100%) ูููุงูุฉ ุงูุญุตุฉ ูุฏู ุนูู ุฌูุฏุฉ ุนุงููุฉ.");
                        color = 'green';
                    } else if (midTime) {
                        messages.push("ุชูุงุนู ููุชุงุฒ (100%) ูู ููุชุตู ุงูุญุตุฉ.");
                        color = 'green';
                    } else { // earlyTime
                        messages.push("ุจุฏุงูุฉ ูููุฉ ูุชูุงุนู 100%.");
                        color = 'yellow'; // ุจุฏุงูุฉ ูููุฉ ูุชููุนุฉุ ููุณุช ุจุงูุถุฑูุฑุฉ ุฌูุฏุฉ ูุงููุฉ
                    }
                } else if (activity === '50%') {
                    if (lateTime) messages.push("ุชูุงุนู ุฌูุฏ (50%)ุ ููู ููุงุญุธ ูุจูุท ูู ูุณุชูู ุงููุดุงุท ููุงูุฉ ุงูุญุตุฉ.");
                    else if (midTime) messages.push("ุชูุงุนู ูุชูุณุท (50%)ุ ูููู ุชุญููุฒ ุงูุทูุงุจ ุฃูุซุฑ.");
                    else messages.push("ุจุฏุงูุฉ ูุชูุณุทุฉ (50%)ุ ุชุญุชุงุฌ ูุฌุฐุจ ุงูุชุจุงู ุฃูุจุฑ.");
                    color = 'yellow'; // 50% ูู ููุทูุฉ ุตูุฑุงุก ุชุญุชุงุฌ ููุงุญุธุฉ
                } else if (activity === '< 50%') {
                    messages.push("ุงูุชุจุงู ููุฎูุถ (< 50%).");
                    if (lateTime) messages.push("ุงูููุช ูุชุฃุฎุฑ ููุฐุง ุงูุงูุฎูุงุถ ูุฏ ูููู ูุชููุนุ ูููู ูุญุชุงุฌ ูุนุงูุฌุฉ.");
                    else messages.push("ูุฌุจ ูุฑุงุฌุนุฉ ุงุณุชุฑุงุชูุฌูุงุช ุฌุฐุจ ุงูุงูุชุจุงู.");
                    color = 'red';
                }

                // 2. ุฑุจุท ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ (ูุฐุง ูู ุงูุฌุฒุก ุงูุฐูู)

                if (style === 'ุบูุฑ ูุดุท' || event === 'ุงููุนูู ูููู ุงูุทูุงุจ ูุณุชูุนูู') {
                    messages.push("ููุญุธ ุงุนุชูุงุฏ ุนูู 'ุงูุชูููู'.");
                    if (color === 'red') {
                        messages.push("ูุฏ ูููู ุงูุชูููู ุณุจุจ ุงูุฎูุงุถ ุงูุชูุงุนู.");
                    } else if (color === 'green') {
                        messages.push("ุฑุบู ุฐููุ ูุงู ุงูุถุจุงุท ุงูุทูุงุจ ุนุงููุงู.");
                    }
                }

                if (style === 'ูุดุท' && color === 'red') {
                    messages.push("ุฑุบู ุชุทุจูู ุฃุณููุจ 'ูุดุท'ุ ุงูุชูุงุนู ููุฎูุถ. ูุฏ ูุญุชุงุฌ ุงููุดุงุท ููุฑุงุฌุนุฉ ุฃู ุชุญููุฒ ุฅุถุงูู.");
                }

                if (!organized) {
                    messages.push("ุงูุจูุฆุฉ ุงูุตููุฉ 'ุบูุฑ ููุธูุฉ'ุ ูุฏ ูุคุซุฑ ุฐูู ุนูู ุงูุชุฑููุฒ.");
                    if (color === 'green') color = 'yellow'; // ุชุฎููุถ ุงูุชูููู: ุฏุฑุณ ููุชุงุฒ ูู ุจูุฆุฉ ููุถููุฉ ููุณ ูุซุงููุงู
                }

                // 3. ูุนุงูุฌุฉ ุงูููุงุญุธุงุช ุงูุฎุทูุฑุฉ (ุงูุฃููููุฉ ุงููุตูู)
                
                if (negative) {
                    messages.push("ุชู ุฑุตุฏ ุฎููู/ุนุจุซุ ููุฐุง ูุคุดุฑ ุฎุทูุฑ ูุชุทูุจ ูุนุงูุฌุฉ ููุฑูุฉ.");
                    color = 'red'; // ูุฐุง ููุบู ุฃู ุชูููู ุฅูุฌุงุจู ุขุฎุฑ
                }

                // ุชุฌููุน ูู ุงูุฑุณุงุฆู ูู ุฑุณุงูุฉ ูุงุญุฏุฉ
                let finalText = messages.join(' ');
                if (finalText.length === 0) finalText = "ุชู ุชุณุฌูู ุงูููุงุญุธุฉ."; // ุญุงูุฉ ุงุญุชูุงุทูุฉ

                return { text: finalText, color: color };
            }

            // 4. ุงูุชุนุงูู ูุน ุชุณุฌูู ุงูููุงุญุธุฉ (Submit)
            form.addEventListener('submit', (e) => {
                e.preventDefault(); 

                // ุฌูุจ ุงูุจูุงูุงุช
                const teacherName = document.getElementById('teacher-name').value;
                const subject = document.getElementById('subject').value;
                const className = document.getElementById('class-name').value;
                const location = document.getElementById('location').value;
                const learningEvent = document.getElementById('learning-event').value;
                const lessonOutput = document.getElementById('lesson-output').value; // ุงูุญูู ุงูุฌุฏูุฏ
                const studentActivity = activityValueInput.value;
                const timeSegment = timeSegmentValueInput.value;
                const learningStyle = learningStyleInput.value;
                
                // ุฌูุจ ุจูุงูุงุช ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ
                const negativeObs = negativeObsCheckbox.checked;
                const organizedEnv = organizedEnvCheckbox.checked;


                // ุงูุชุญูู ูู ุงูุจูุงูุงุช
                if (!teacherName || !subject || !className) {
                    errorMessage.textContent = 'ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุญููู ุงููุนูู ูุงููุงุฏุฉ ูุงููุตู.';
                    return;
                }
                if (!timeSegment) {
                    errorMessage.textContent = 'ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุชูููุช ุงูุฑุตุฏ ูู ุงููุฑุจุนุงุช.';
                    return;
                }
                 if (!learningStyle) {
                    errorMessage.textContent = 'ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุฃุณููุจ ุงูุชุนูู.';
                    return;
                }
                if (!studentActivity) {
                    errorMessage.textContent = 'ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุณุจุฉ ูุดุงุท ุงูุทูุงุจ ูู ุงูุฏุงุฆุฑุฉ.';
                    return;
                }
                // ูุง ูุญุชุงุฌ ุงูุชุญูู ูู ูุฎุฑุฌุงุช ุงูุญุตุฉ ูุฃู ููุง ูููุฉ ุงูุชุฑุงุถูุฉ "ูุง ููุฌุฏ"

                // --- ุชุนุจุฆุฉ ูุนุฑุถ ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) ---
                
                // ุชุนุจุฆุฉ ุงูุจูุงูุงุช
                reportTeacher.textContent = teacherName;
                reportSubject.textContent = subject;
                reportClass.textContent = className;
                reportTimeSegment.textContent = timeSegment;
                reportEvent.textContent = learningEvent;
                reportStyle.textContent = learningStyle;
                reportOutput.textContent = lessonOutput; // ุชุนุจุฆุฉ ุงูุญูู ุงูุฌุฏูุฏ
                reportActivityValue.textContent = studentActivity;

                // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ ูู ุงูุจุทุงูุฉ
                reportOrganizedEnv.textContent = organizedEnv ? "ููุธูุฉ" : "ุบูุฑ ููุธูุฉ";
                reportOrganizedEnv.className = organizedEnv ? "text-lg font-bold text-green-600" : "text-lg font-bold text-red-600";
                reportNegativeObs.textContent = negativeObs ? "ุชู ููุงุญุธุชูุง" : "ูุง ููุฌุฏ";
                reportNegativeObs.className = negativeObs ? "text-lg font-bold text-red-600" : "text-lg font-bold text-green-600";


                // ุชุญุฏูุซ ุดุฑูุท ุงูุฑุณู ุงูุจูุงูู
                reportActivityBar.classList.remove('bg-green-500', 'bg-yellow-500', 'bg-red-500', 'w-full', 'w-1/2', 'w-1/4');
                if (studentActivity === '100%') {
                    reportActivityBar.classList.add('bg-green-500', 'w-full');
                } else if (studentActivity === '50%') {
                    reportActivityBar.classList.add('bg-yellow-500', 'w-1/2');
                } else { // < 50%
                    reportActivityBar.classList.add('bg-red-500', 'w-1/4');
                }

                // ุชุญุฏูุซ ูุคุดุฑ ุฌูุฏุฉ ุงูุชูุงุนู (ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ)
                const quality = calculateQuality(studentActivity, timeSegment, learningStyle, organizedEnv, negativeObs, learningEvent);
                reportQualityText.textContent = quality.text;
                reportQualityIndicator.classList.remove('bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800', 'bg-red-100', 'text-red-800');
                if (quality.color === 'green') {
                    reportQualityIndicator.classList.add('bg-green-100', 'text-green-800');
                } else if (quality.color === 'yellow') {
                    reportQualityIndicator.classList.add('bg-yellow-100', 'text-yellow-800');
                } else {
                    reportQualityIndicator.classList.add('bg-red-100', 'text-red-800');
                }

                // ุฅุธูุงุฑ ุงููุงูุฐุฉ
                reportModal.classList.remove('hidden');
                setTimeout(() => {
                    modalCard.classList.remove('scale-95', 'opacity-0');
                    modalCard.classList.add('scale-100', 'opacity-100');
                }, 50);

                // --- ุฅุนุงุฏุฉ ุชุนููู ุงูููุฑู ---
                form.reset();
                activityValueInput.value = '';
                timeSegmentValueInput.value = '';
                learningStyleInput.value = '';
                document.getElementById('lesson-output').value = 'ูุง ููุฌุฏ'; // ุฅุนุงุฏุฉ ุชุนููู ุงููุงุฆูุฉ
                document.getElementById('class-name').value = ''; // ุฅุนุงุฏุฉ ุชุนููู ูุงุฆูุฉ ุงููุตู
                
                // ุฅุนุงุฏุฉ ุชุนููู ุงูููุงุญุธุงุช ุงูุฅุถุงููุฉ
                negativeObsCheckbox.checked = false;
                organizedEnvCheckbox.checked = false;

                sectors.forEach(s => s.classList.remove('sector-selected'));
                timeSegments.forEach(s => s.classList.remove('time-segment-selected'));
                styleButtons.forEach(s => s.classList.remove('style-btn-selected'));
                errorMessage.textContent = '';
            });

            // 5. ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
            function closeModal() {
                modalCard.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    reportModal.classList.add('hidden');
                    modalCard.classList.remove('scale-100', 'opacity-100'); 
                }, 300); 
            }

            closeModalBtn.addEventListener('click', closeModal);
            reportModal.addEventListener('click', (e) => {
                if (e.target === reportModal) {
                    closeModal();
                }
            });

            // 6. ุงูุชุนุงูู ูุน ุฒุฑ ุงูุทุจุงุนุฉ (ุชุตุฏูุฑ PDF)
            printModalBtn.addEventListener('click', () => {
                // 1. ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ูุชุบููุฑ ุงููุต ูุฅุธูุงุฑ ุงูุชุญููู
                printModalBtn.textContent = 'ุฌุงุฑู ุงูุฅูุดุงุก...';
                printModalBtn.disabled = true;
                closeModalBtn.classList.add('hidden'); // ุฅุฎูุงุก ุฒุฑ ุงูุฅุบูุงู ูุคูุชุงู
                
                const cardToExport = document.getElementById('printable-card');
                const { jsPDF } = window.jspdf; // ุงุณุชุฏุนุงุก ููุชุจุฉ jsPDF

                // 2. ุงุณุชุฎุฏุงู html2canvas ูุฃุฎุฐ "ููุทุฉ ุดุงุดุฉ" ููุจุทุงูุฉ
                html2canvas(cardToExport, {
                    scale: 2, // ุฒูุงุฏุฉ ุงูุฏูุฉ
                    useCORS: true,
                    // ูุนุงูุฌุฉ ุจุนุถ ูุดุงูู ุงูุนุฑุถ ูุจู ุฃุฎุฐ ุงูููุทุฉ
                    onclone: (document) => {
                        document.getElementById('printable-card').style.transform = 'none';
                        document.getElementById('printable-card').style.transition = 'none';
                    }
                }).then(canvas => {
                    // 3. ุฅูุดุงุก ููู PDF
                    const imgData = canvas.toDataURL('image/png');
                    const doc = new jsPDF('p', 'mm', 'a4'); // A4 portrait
                    
                    const pdfWidth = doc.internal.pageSize.getWidth(); // ุนุฑุถ A4
                    const pdfHeight = doc.internal.pageSize.getHeight(); // ุทูู A4

                    const canvasWidth = canvas.width;
                    const canvasHeight = canvas.height;
                    
                    // ุงูุญูุงุธ ุนูู ูุณุจุฉ ุงูุนุฑุถ ุฅูู ุงูุงุฑุชูุงุน
                    const ratio = canvasWidth / canvasHeight;
                    let imgWidth = pdfWidth - 20; // ุนุฑุถ ุงูุตูุฑุฉ (ูุน ูุงูุด 10ูู ูู ูู ุฌุงูุจ)
                    let imgHeight = imgWidth / ratio;

                    // ุฅุฐุง ูุงู ุงูุทูู ุฃูุจุฑ ูู ุงูุตูุญุฉุ ูุตุบุฑ ุงูุฃุจุนุงุฏ
                    if (imgHeight > pdfHeight - 20) {
                        imgHeight = pdfHeight - 20; // (ูุน ูุงูุด 10ูู ุนููู ูุณููู)
                        imgWidth = imgHeight * ratio;
                    }

                    // ุชูุณูุท ุงูุตูุฑุฉ ูู ุงูุตูุญุฉ
                    const xOffset = (pdfWidth - imgWidth) / 2;
                    const yOffset = (pdfHeight - imgHeight) / 2;

                    doc.addImage(imgData, 'PNG', xOffset, yOffset, imgWidth, imgHeight);
                    
                    // 4. ุญูุธ ุงูููู
                    doc.save('ุจุทุงูุฉ-ููุงุญุธุฉ-ุตููุฉ.pdf');

                }).finally(() => {
                    // 5. ุฅุนุงุฏุฉ ุงูุฃุฒุฑุงุฑ ูุญุงูุชูุง ุงูุทุจูุนูุฉ ุจุนุฏ ุงูุชูุงุก ุงูุนูููุฉ
                    printModalBtn.textContent = 'ุชุตุฏูุฑ PDF';
                    printModalBtn.disabled = false;
                    closeModalBtn.classList.remove('hidden'); // ุฅุนุงุฏุฉ ุฅุธูุงุฑ ุฒุฑ ุงูุฅุบูุงู
                });
            });
        });
    </script>
</body>
</html>

