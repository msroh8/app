<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ</title>

    <!-- Ø®Ø· Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Ù…ÙƒØªØ¨Ø§Øª ØªÙˆÙ„ÙŠØ¯ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            margin: 0;
            background: #f2f2f2;
            font-family: 'Cairo', sans-serif;
        }

        .layout {
            display: flex;
            width: 100%;
        }

        .side-column {
            width: 90px;
            background: #2d2d2d;
            min-height: 100vh;
        }

        .main-area {
            flex-grow: 1;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        .main-header {
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .main-header img {
            height: 140px;
            width: auto;
        }

        /* NAVBAR */
        .top-navbar {
            background: #ffffff;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 6px rgba(0,0,0,0.07);
        }

        .top-navbar ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .top-navbar a {
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            padding: 10px 18px;
            border-radius: 8px;
            transition: 0.3s;
        }

        .top-navbar a:hover {
            background: #008c5f;
            color: white;
            transform: translateY(-2px);
        }

        .page-content {
            max-width: 900px;
            margin: 40px auto 10px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            line-height: 1.9;
            box-shadow: 0 0 8px rgba(0,0,0,0.12);
        }

        .page-content h1 {
            font-size: 22px;
            font-weight: 700;
            margin-top: 0;
        }

        /* Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ£Ù…Ù„ */
        .reflection-box {
            margin-top: 40px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(0,0,0,0.12);
            display: none;
        }

        .reflection-box h2 {
            margin-top: 0;
            font-size: 22px;
        }

        select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .item-row {
            margin: 18px 0;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 10px;
        }

        .item-title {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .options {
            display: flex;
            gap: 25px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .opt label {
            font-size: 16px;
            cursor: pointer;
        }

        .opt input {
            transform: scale(1.1);
            margin-left: 6px;
        }

        .green { color: #0a7d21; }
        .red { color: #c62828; }
        .orange { color: #f57c00; }

        .comment-box {
            width: 100%;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 6px;
            font-size: 14px;
            resize: none;
        }

        .btn-small {
            background: #008c5f;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-small:disabled {
            opacity: 0.5;
            cursor: default;
        }

        /* MODAL */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99;
        }

        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 350px;
            box-shadow: 0 0 10px rgba(0,0,0,0.22);
        }

        .modal-box h3 {
            margin-top: 0;
            font-size: 20px;
            font-weight: 700;
        }

        .modal-box input {
            width: 100%;
            padding: 10px;
            margin: 6px 0 14px;
            font-size: 17px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .btn {
            background: #008c5f;
            color: white;
            padding: 10px 18px;
            border: none;
            font-size: 17px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
        }

        .btn:hover {
            opacity: 0.9;
        }

        /* Ø£Ø¯Ø§Ø© SWOT */
        .swot-box {
            margin-top: 40px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(0,0,0,0.12);
            display: none;
        }

        .swot-box h2 {
            margin-top: 0;
            font-size: 22px;
        }

        .swot-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .swot-card {
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #ddd;
        }

        .swot-card h3 {
            margin-top: 0;
            margin-bottom: 4px;
            font-size: 18px;
        }

        .swot-hint {
            font-size: 12px;
            color: #555;
            margin: 0 0 6px;
        }

        .swot-input {
            width: 100%;
            min-height: 50px;
            border-radius: 8px;
            border: 1px solid #ccc;
            padding: 8px;
            font-size: 14px;
            resize: vertical;
        }

        .swot-add {
            margin-top: 8px;
            margin-bottom: 10px;
            background: #0066cc;
            color: white;
            padding: 6px 14px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            cursor: pointer;
        }

        .swot-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .swot-list li {
            background: white;
            border-radius: 6px;
            padding: 6px 8px;
            margin-bottom: 6px;
            border: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .swot-del {
            background: transparent;
            border: none;
            color: #c62828;
            cursor: pointer;
            font-size: 16px;
        }

        .swot-strength {
            background: #e8f5e9;
            border-color: #c8e6c9;
        }

        .swot-weakness {
            background: #ffebee;
            border-color: #ffcdd2;
        }

        .swot-opportunity {
            background: #e3f2fd;
            border-color: #bbdefb;
        }

        .swot-threat {
            background: #fff3e0;
            border-color: #ffe0b2;
        }

        @media (max-width: 800px) {
            .swot-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .report-box {
            margin-top: 40px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(0,0,0,0.12);
            display: none;
        }

        .report-box h2 {
            margin-top: 0;
            font-size: 22px;
        }

        #statsChart {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
            background: #fafafa;
            text-align: center;
        }

        /* ØµÙØ­Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ù„Ù„ØªØµØ¯ÙŠØ± PDF) */
        .report-pages-container {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 794px; /* Ø¹Ø±Ø¶ A4 ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ */
        }

        .report-page {
            width: 794px;
            min-height: 1123px; /* Ø§Ø±ØªÙØ§Ø¹ A4 ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ */
            padding: 40px 40px 60px;
            box-sizing: border-box;
            background: white;
            margin-bottom: 20px;
        }

        .report-header {
            position: relative;
            margin-bottom: 18px;
        }

        .report-header img {
            height: 40px;
            width: 100%;
            object-fit: cover;
            display: block;
        }

        .report-title {
            position: absolute;
            right: 220px;      /* Ù†ØªØ±Ùƒ Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø´Ø¹Ø§Ø± */
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            text-align: right;
            max-width: 60%;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .report-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .report-table th,
        .report-table td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            vertical-align: top;
        }

        .report-table th {
            background: #f5f5f5;
        }

        .report-stat-line {
            font-size: 13px;
        }

        .main-footer {
            text-align: center;
            font-size: 14px;
            color: #555;
            margin: 5px 0 20px;
        }
    </style>
</head>

<body>

<div class="layout">

    <div class="side-column"></div>

    <div class="main-area">

        <header class="main-header">
            <img src="https://raw.githubusercontent.com/msroh8/app/main/HEADR2.jpg" alt="Ø´Ø¹Ø§Ø±" crossorigin="anonymous">
        </header>

        <nav class="top-navbar">
            <ul>
                <li><a href="#" id="btn-main">ğŸ  Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#" id="btn-reflect">ğŸ§˜ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ£Ù…Ù„</a></li>
                <li><a href="#" id="btn-swot">ğŸ“Š Ø£Ø¯Ø§Ø© SWOT</a></li>
                <li><a href="#" id="btn-report">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±</a></li>
            </ul>
        </nav>

        <div class="page-content">
            <h1>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</h1>

            <p><b>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©:</b> <span id="out-edara">---</span></p>
            <p><b>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</b> <span id="out-school">---</span></p>
            <p><b>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</b> <span id="out-teacher">---</span></p>
            <p><b>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</b> <span id="out-manager">---</span></p>

            <!-- Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ£Ù…Ù„ -->
            <div class="reflection-box" id="reflectionBox">
                <h2>ğŸ§˜ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ</h2>

                <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙˆØ±:</label>
                <select id="pivotSelect">
                    <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙˆØ± â€”</option>
                    <option>Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©</option>
                    <option>Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ</option>
                    <option>Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</option>
                    <option>Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³</option>
                    <option>ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†</option>
                    <option>Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…</option>
                    <option>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</option>
                    <option>Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</option>
                    <option>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©</option>
                    <option>ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†</option>
                    <option>Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</option>
                </select>

                <div id="checklistContainer"></div>

                <button class="btn-small" id="nextPivot">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
            </div>

            <!-- Ø£Ø¯Ø§Ø© SWOT -->
            <div class="swot-box" id="swotBox">
                <h2>ğŸ“Š Ø£Ø¯Ø§Ø© SWOT Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>

                <div class="swot-grid">

                    <div class="swot-card swot-strength" data-type="strength">
                        <h3>ğŸ’ª Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© (Strengths)</h3>
                        <p class="swot-hint">Ù…Ø«Ø§Ù„: "Ø¥Ø¬Ø§Ø¯Ø© ØªÙ†ÙˆÙŠØ¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³" Ø£Ùˆ "Ø¹Ù„Ø§Ù‚Ø© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨".</p>
                        <textarea id="strengthInput" class="swot-input" placeholder="Ø£Ø¶Ù Ù†Ù‚Ø·Ø© Ù‚ÙˆØ©..."></textarea>
                        <button class="swot-add" onclick="addSWOT('strength')">Ø¥Ø¶Ø§ÙØ©</button>
                        <ul id="strengthList" class="swot-list"></ul>
                    </div>

                    <div class="swot-card swot-weakness" data-type="weakness">
                        <h3>âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù (Weaknesses)</h3>
                        <p class="swot-hint">Ù…Ø«Ø§Ù„: "Ø§Ù„ØªØ£Ø®Ø± ÙÙŠ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©" Ø£Ùˆ "Ø¶Ø¹Ù ÙÙŠ ØªÙˆØ¸ÙŠÙ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙˆÙŠÙ…".</p>
                        <textarea id="weaknessInput" class="swot-input" placeholder="Ø£Ø¶Ù Ù†Ù‚Ø·Ø© Ø¶Ø¹Ù..."></textarea>
                        <button class="swot-add" onclick="addSWOT('weakness')">Ø¥Ø¶Ø§ÙØ©</button>
                        <ul id="weaknessList" class="swot-list"></ul>
                    </div>

                    <div class="swot-card swot-opportunity" data-type="opportunity">
                        <h3>ğŸŒ± Ø§Ù„ÙØ±Øµ (Opportunities)</h3>
                        <p class="swot-hint">Ù…Ø«Ø§Ù„: "Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ù†ÙŠ Ø§Ù„Ù…ØªØ§Ø­Ø©" Ø£Ùˆ "Ø¨Ø±Ø§Ù…Ø¬ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù…Ù† Ø§Ù„ÙˆØ²Ø§Ø±Ø©".</p>
                        <textarea id="opportunityInput" class="swot-input" placeholder="Ø£Ø¶Ù ÙØ±ØµØ©..."></textarea>
                        <button class="swot-add" onclick="addSWOT('opportunity')">Ø¥Ø¶Ø§ÙØ©</button>
                        <ul id="opportunityList" class="swot-list"></ul>
                    </div>

                    <div class="swot-card swot-threat" data-type="threat">
                        <h3>âš¡ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª (Threats)</h3>
                        <p class="swot-hint">Ù…Ø«Ø§Ù„: "ÙƒØ«Ø±Ø© Ø§Ù„Ø£Ø¹Ø¨Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©" Ø£Ùˆ "Ø¶Ø¹Ù Ø§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©".</p>
                        <textarea id="threatInput" class="swot-input" placeholder="Ø£Ø¶Ù ØªÙ‡Ø¯ÙŠØ¯Ù‹Ø§..."></textarea>
                        <button class="swot-add" onclick="addSWOT('threat')">Ø¥Ø¶Ø§ÙØ©</button>
                        <ul id="threatList" class="swot-list"></ul>
                    </div>

                </div>
            </div>

            <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± -->
            <div class="report-box" id="reportBox">
                <h2>ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
                <p>ÙŠØ¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®Ø·Ø·Ù‹Ø§ Ø¯Ø§Ø¦Ø±ÙŠÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ù„Ù„Ù…Ø­Ø§ÙˆØ±ØŒ Ù…Ù„ÙˆÙ‘Ù†Ù‹Ø§ Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ù…Ù…ÙŠØ² / Ù…ØªÙˆØ³Ø· / Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø³ÙŠÙ†)ØŒ Ø«Ù… ÙŠÙ…ÙƒÙ† ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± PDF Ù…ÙØµÙ„.</p>

                <div id="statsChart"></div>

                <button class="btn" id="btn-generate-pdf" style="margin-top:20px;">ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± PDF</button>
            </div>

        </div>

        <footer class="main-footer">
            ÙÙƒØ±Ø© ÙˆØªÙ†ÙÙŠØ°: Ù…Ø­Ù…Ø¯ Ù…Ø¬Ù…Ù…ÙŠ
        </footer>

    </div>

    <div class="side-column"></div>

</div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø¨Ù†Ø§Ø¡ ØµÙØ­Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± (ØºÙŠØ± Ø¸Ø§Ù‡Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…) -->
<div class="report-pages-container" id="reportPagesContainer"></div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div class="modal" id="modal">
    <div class="modal-box">
        <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>

        <label>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù€</label>
        <input type="text" id="edara">

        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
        <input type="text" id="school">

        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label>
        <input type="text" id="teacher">

        <label>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
        <input type="text" id="manager">

        <button class="btn" id="save">Ø­ÙØ¸</button>
    </div>
</div>

<script>
    // Ø¹Ù†Ø§ØµØ± Ø¹Ø§Ù…Ø©
    const modal              = document.getElementById("modal");
    const btnMain            = document.getElementById("btn-main");
    const btnReflect         = document.getElementById("btn-reflect");
    const btnSwot            = document.getElementById("btn-swot");
    const btnReport          = document.getElementById("btn-report");
    const reflectionBox      = document.getElementById("reflectionBox");
    const swotBox            = document.getElementById("swotBox");
    const reportBox          = document.getElementById("reportBox");
    const pivotSelect        = document.getElementById("pivotSelect");
    const checklistContainer = document.getElementById("checklistContainer");
    const nextPivotBtn       = document.getElementById("nextPivot");
    const reportPagesContainer = document.getElementById("reportPagesContainer");
    const btnGeneratePDF     = document.getElementById("btn-generate-pdf");
    const statsChart         = document.getElementById("statsChart");

    const inpEdara   = document.getElementById("edara");
    const inpSchool  = document.getElementById("school");
    const inpTeacher = document.getElementById("teacher");
    const inpManager = document.getElementById("manager");

    const outEdara   = document.getElementById("out-edara");
    const outSchool  = document.getElementById("out-school");
    const outTeacher = document.getElementById("out-teacher");
    const outManager = document.getElementById("out-manager");

    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    btnMain.onclick = (e) => {
        e.preventDefault();
        modal.style.display = "flex";
        inpEdara.value   = localStorage.getItem("edara")   || "";
        inpSchool.value  = localStorage.getItem("school")  || "";
        inpTeacher.value = localStorage.getItem("teacher") || "";
        inpManager.value = localStorage.getItem("manager") || "";
    };

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById("save").onclick = () => {
        localStorage.setItem("edara",   inpEdara.value);
        localStorage.setItem("school",  inpSchool.value);
        localStorage.setItem("teacher", inpTeacher.value);
        localStorage.setItem("manager", inpManager.value);
        loadMainData();
        modal.style.display = "none";
    };

    function loadMainData() {
        outEdara.textContent   = localStorage.getItem("edara")   || "---";
        outSchool.textContent  = localStorage.getItem("school")  || "---";
        outTeacher.textContent = localStorage.getItem("teacher") || "---";
        outManager.textContent = localStorage.getItem("manager") || "---";
    }

    loadMainData();

    modal.onclick = (e) => {
        if (e.target === modal) modal.style.display = "none";
    };

    // ÙØªØ­ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ£Ù…Ù„
    btnReflect.onclick = (e) => {
        e.preventDefault();
        swotBox.style.display   = "none";
        reportBox.style.display = "none";
        reflectionBox.style.display = "block";
        window.scrollTo({ top: reflectionBox.offsetTop - 30, behavior: "smooth" });
    };

    // ÙØªØ­ Ø£Ø¯Ø§Ø© SWOT
    btnSwot.onclick = (e) => {
        e.preventDefault();
        reflectionBox.style.display = "none";
        reportBox.style.display     = "none";
        swotBox.style.display       = "block";
        window.scrollTo({ top: swotBox.offsetTop - 30, behavior: "smooth" });
    };

    // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø±ÙŠØ±
    btnReport.onclick = (e) => {
        e.preventDefault();
        reflectionBox.style.display = "none";
        swotBox.style.display       = "none";
        reportBox.style.display     = "block";
        buildStatsChart();
        window.scrollTo({ top: reportBox.offsetTop - 30, behavior: "smooth" });
    };

    // Ù…Ø­Ø§ÙˆØ± Ø§Ù„ØªØ£Ù…Ù„ ÙˆØ¹Ù†Ø§ØµØ±Ù‡Ø§
    const reflectionItems = {
        "Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©": [
            "Ø£Ø·Ø¨Ù‚ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª.",
            "Ø£Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ.",
            "Ø£Ø¤Ø¯ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø¯Ù‚Ø© ÙˆØ¬ÙˆØ¯Ø©.",
            "Ø£Ù„ØªØ²Ù… Ø¨Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ø©."
        ],
        "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ": [
            "Ø£ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ù…Ø¹ Ø§Ù„Ø²Ù…Ù„Ø§Ø¡.",
            "Ø£Ø´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©.",
            "Ø£Ø­Ø¶Ø± ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©.",
            "Ø£Ø¯Ø¹Ù… Ø²Ù…Ù„Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©."
        ],
        "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±": [
            "Ø£ØªÙˆØ§ØµÙ„ Ø¨ÙØ¹Ø§Ù„ÙŠØ© Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±.",
            "Ø£Ø¹Ù‚Ø¯ Ù„Ù‚Ø§Ø¡Ø§Øª Ø¯ÙˆØ±ÙŠØ© Ù…Ø¹Ù‡Ù….",
            "Ø£ØªØ§Ø¨Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ø§Ù„Ø¨.",
            "Ø£Ø³ØªØ«Ù…Ø± Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±."
        ],
        "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³": [
            "Ø£Ù†ÙˆØ¹ ÙÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³.",
            "Ø£Ø·Ø¨Ù‚ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù†Ø´Ø·.",
            "Ø£Ø±Ø§Ø¹ÙŠ Ø§Ù„ÙØ±ÙˆÙ‚ Ø§Ù„ÙØ±Ø¯ÙŠØ©.",
            "Ø£ØµÙ…Ù… Ø£Ù†Ø´Ø·Ø© ØªÙØ§Ø¹Ù„ÙŠØ© ÙˆÙ…Ø­ÙØ²Ø©."
        ],
        "ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†": [
            "Ø£Ø­Ù„Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ø´ÙƒÙ„ Ù…Ù†ØªØ¸Ù….",
            "Ø£Ø¶Ø¹ Ø®Ø·Ø· Ø¹Ù„Ø§Ø¬ÙŠØ© ÙˆØªØ­Ø³ÙŠÙ†ÙŠØ©.",
            "Ø£Ø³ØªØ®Ø¯Ù… Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ³.",
            "Ø£ØªØ§Ø¨Ø¹ ØªØ­Ø³Ù† Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ."
        ],
        "Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…": [
            "Ø£Ø¹Ø¯ Ø®Ø·Ø© ØªØ¹Ù„Ù… ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ÙƒØªÙˆØ¨Ø©.",
            "Ø£Ø±Ø¨Ø· Ø§Ù„Ø®Ø·Ø© Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±.",
            "Ø£Ø±Ø§Ø¬Ø¹ ØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø·Ø© Ø¯ÙˆØ±ÙŠÙ‹Ø§.",
            "Ø£Ø¹Ø¯Ù„ Ø§Ù„Ø®Ø·Ø© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨."
        ],
        "Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©": [
            "Ø£Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.",
            "Ø£ÙˆØ¸Ù Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠØ© ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.",
            "Ø£Ø¯Ù…Ø¬ ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆØ£Ø¯ÙˆØ§Øª ØªÙØ§Ø¹Ù„ÙŠØ©.",
            "Ø£ÙˆØ¬Ù‡ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙÙŠ ØªØ¹Ù„Ù…Ù‡Ù…."
        ],
        "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©": [
            "Ø£ÙˆÙØ± Ø¨ÙŠØ¦Ø© ØµÙÙŠØ© Ø¢Ù…Ù†Ø© ÙˆÙ…Ø­ÙØ²Ø©.",
            "Ø£Ù†Ø¸Ù… Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù…Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ù„Ù….",
            "Ø£Ø¹Ø²Ø² Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ.",
            "Ø£Ø®Ù„Ù‚ Ù…Ù†Ø§Ø®Ù‹Ø§ Ù…Ø´Ø¬Ø¹Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©."
        ],
        "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©": [
            "Ø£Ø¶Ø¨Ø· Ø§Ù„Ø³Ù„ÙˆÙƒ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ Ø¨Ø­ÙƒÙ…Ø©.",
            "Ø£Ø¯ÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø­ØµØ© Ø¨ÙØ§Ø¹Ù„ÙŠØ©.",
            "Ø£ÙˆØ²Ø¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ø¨.",
            "Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ø·Ø§Ø±Ø¦Ø© Ø¨Ù‡Ø¯ÙˆØ¡."
        ],
        "ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†": [
            "Ø£Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨.",
            "Ø£ÙØ³Ø± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª.",
            "Ø£Ø¹Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ù„Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†.",
            "Ø£Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ©."
        ],
        "Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…": [
            "Ø£Ù†ÙˆØ¹ Ø£Ø¯ÙˆØ§Øª ÙˆØ£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ….",
            "Ø£Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.",
            "Ø£Ø·Ø¨Ù‚ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªÙƒÙˆÙŠÙ†ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ù„Ù….",
            "Ø£Ø³ØªØ¹Ù…Ù„ Ø§Ù„Ø±ÙˆØ¨Ø±ÙƒØ§Øª Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡."
        ]
    };

    const pivotOrder = [
        "Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©",
        "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ù‡Ù†ÙŠ",
        "Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±",
        "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ³",
        "ØªØ­Ø³ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",
        "Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù…",
        "Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©",
        "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©",
        "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙŠØ©",
        "ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙŠÙ†",
        "Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…"
    ];

    // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙˆØ± Ù„Ù„ØªØ£Ù…Ù„
    pivotSelect.onchange = function () {
        const pivot = this.value;
        checklistContainer.innerHTML = "";

        if (!pivot || !reflectionItems[pivot]) {
            nextPivotBtn.disabled = true;
            nextPivotBtn.textContent = "Ø§Ù„ØªØ§Ù„ÙŠ â–¶";
            return;
        }

        const idx = pivotOrder.indexOf(pivot);
        if (idx === pivotOrder.length - 1) {
            nextPivotBtn.textContent = "Ø¥Ù†Ù‡Ø§Ø¡";
        } else {
            nextPivotBtn.textContent = "Ø§Ù„ØªØ§Ù„ÙŠ â–¶";
        }
        nextPivotBtn.disabled = false;

        reflectionItems[pivot].forEach((text, index) => {
            const baseID     = `${pivot}_${index}`;
            const storageKey = baseID;
            const commentKey = baseID + "_comment";

            const row = document.createElement("div");
            row.className = "item-row";

            row.innerHTML = `
                <div class="item-title">${text}</div>
                <div class="options">
                    <div class="opt green">
                        <input type="radio" id="${baseID}_always" name="${baseID}" value="Ø¯Ø§Ø¦Ù…Ù‹Ø§">
                        <label for="${baseID}_always">Ø¯Ø§Ø¦Ù…Ù‹Ø§</label>
                    </div>
                    <div class="opt orange">
                        <input type="radio" id="${baseID}_sometimes" name="${baseID}" value="Ø£Ø­ÙŠØ§Ù†Ù‹Ø§">
                        <label for="${baseID}_sometimes">Ø£Ø­ÙŠØ§Ù†Ù‹Ø§</label>
                    </div>
                    <div class="opt red">
                        <input type="radio" id="${baseID}_never" name="${baseID}" value="Ø£Ø¨Ø¯Ù‹Ø§">
                        <label for="${baseID}_never">Ø£Ø¨Ø¯Ù‹Ø§</label>
                    </div>
                </div>
                <textarea class="comment-box" id="${commentKey}" placeholder="ØªØ¹Ù„ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
            `;

            checklistContainer.appendChild(row);

            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            const savedChoice = localStorage.getItem(storageKey);
            if (savedChoice) {
                const radios = row.querySelectorAll(`input[name="${baseID}"]`);
                radios.forEach(r => {
                    if (r.value === savedChoice) r.checked = true;
                });
            }

            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
            const savedComment = localStorage.getItem(commentKey);
            if (savedComment) {
                document.getElementById(commentKey).value = savedComment;
            }

            // Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
            row.querySelectorAll(`input[name="${baseID}"]`).forEach(radio => {
                radio.onchange = () => {
                    localStorage.setItem(storageKey, radio.value);
                };
            });

            // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
            document.getElementById(commentKey).onkeyup = (e) => {
                localStorage.setItem(commentKey, e.target.value);
            };
        });
    };

    // Ø²Ø± "Ø§Ù„ØªØ§Ù„ÙŠ / Ø¥Ù†Ù‡Ø§Ø¡"
    nextPivotBtn.onclick = () => {
        const current = pivotSelect.value;

        if (!current) {
            pivotSelect.value = pivotOrder[0];
            pivotSelect.dispatchEvent(new Event("change"));
            return;
        }

        const idx = pivotOrder.indexOf(current);
        if (idx === -1) return;

        if (idx < pivotOrder.length - 1) {
            const next = pivotOrder[idx + 1];
            pivotSelect.value = next;
            pivotSelect.dispatchEvent(new Event("change"));
        } else {
            reflectionBox.style.display = "none"; // Ø¢Ø®Ø± Ù…Ø­ÙˆØ±
        }
    };

    // ---------------- SWOT ----------------
    function getSWOTKey(type) {
        return "swot_" + type;
    }

    function addSWOT(type) {
        const input = document.getElementById(type + "Input");
        const text = (input.value || "").trim();
        if (!text) return;

        const listKey = getSWOTKey(type);
        const stored = JSON.parse(localStorage.getItem(listKey) || "[]");
        stored.push(text);
        localStorage.setItem(listKey, JSON.stringify(stored));

        input.value = "";
        renderSWOT(type);
    }

    function renderSWOT(type) {
        const listKey = getSWOTKey(type);
        const data = JSON.parse(localStorage.getItem(listKey) || "[]");
        const ul = document.getElementById(type + "List");
        ul.innerHTML = "";

        data.forEach((item, index) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <span>${item}</span>
                <button class="swot-del" onclick="deleteSWOT('${type}', ${index})">&times;</button>
            `;
            ul.appendChild(li);
        });
    }

    function deleteSWOT(type, index) {
        const listKey = getSWOTKey(type);
        const data = JSON.parse(localStorage.getItem(listKey) || "[]");
        data.splice(index, 1);
        localStorage.setItem(listKey, JSON.stringify(data));
        renderSWOT(type);
    }

    function loadAllSWOT() {
        ["strength", "weakness", "opportunity", "threat"].forEach(renderSWOT);
    }

    loadAllSWOT();

    // ---------------- Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø­Ø³Ø§Ø¨ ØªÙ‚ÙŠÙŠÙ… Ù…Ø­ÙˆØ± ----------------
    function computePivotStats(pivot) {
        const items = reflectionItems[pivot] || [];
        const stats = { "Ø¯Ø§Ø¦Ù…Ù‹Ø§": 0, "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§": 0, "Ø£Ø¨Ø¯Ù‹Ø§": 0 };
        const rows  = [];

        items.forEach((text, index) => {
            const baseID  = `${pivot}_${index}`;
            const val     = localStorage.getItem(baseID) || "";
            const comment = localStorage.getItem(baseID + "_comment") || "";

            if (stats[val] !== undefined) stats[val]++;

            rows.push({
                text,
                value: val || "â€”",
                comment: comment || "â€”"
            });
        });

        const total = stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] + stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"] + stats["Ø£Ø¨Ø¯Ù‹Ø§"];
        let performance = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
        let percentAlways = 0;

        if (total > 0) {
            percentAlways = (stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] / total) * 100;

            if (percentAlways >= 60 && stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] >= stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"] && stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] >= stats["Ø£Ø¨Ø¯Ù‹Ø§"]) {
                performance = "Ø£Ø¯Ø§Ø¡ Ù…Ù…ÙŠØ²";
            } else if (stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"] >= stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] && stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"] >= stats["Ø£Ø¨Ø¯Ù‹Ø§"]) {
                performance = "Ø£Ø¯Ø§Ø¡ Ù…ØªÙˆØ³Ø·";
            } else {
                performance = "Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø³ÙŠÙ†";
            }
        }

        return { stats, rows, total, performance, percentAlways };
    }

    // ---------------- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Pie SVG ÙˆØ§Ø­Ø¯) ----------------
    function getStatsSVG() {
        const segments = [];
        let totalSlices = 0;

        pivotOrder.forEach(pivot => {
            const { stats, total, performance, percentAlways } = computePivotStats(pivot);
            if (total === 0) return;

            let color = "#c62828"; // Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø³ÙŠÙ†
            if (performance === "Ø£Ø¯Ø§Ø¡ Ù…Ù…ÙŠØ²") color = "#0a7d21";
            else if (performance === "Ø£Ø¯Ø§Ø¡ Ù…ØªÙˆØ³Ø·") color = "#f57c00";

            segments.push({
                pivot,
                total,
                performance,
                percentAlways,
                color,
                stats
            });

            totalSlices += total;
        });

        if (segments.length === 0 || totalSlices === 0) {
            return "";
        }

        const width = 500;
        const height = 500;
        const radius = 180;
        const cx = width / 2;
        const cy = height / 2;

        let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" dir="ltr">
            <rect x="0" y="0" width="${width}" height="${height}" fill="#ffffff"/>
            <text x="${width / 2}" y="24" text-anchor="middle" font-size="16" font-weight="600">
                Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ø³Ø¨ÙŠ Ù„Ù„Ù…Ø­Ø§ÙˆØ± Ø­Ø³Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡
            </text>
        `;

        let currentAngle = -Math.PI / 2; // Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰

        segments.forEach(seg => {
            const angle = (seg.total / totalSlices) * Math.PI * 2;
            const startAngle = currentAngle;
            const endAngle = currentAngle + angle;

            const x1 = cx + radius * Math.cos(startAngle);
            const y1 = cy + radius * Math.sin(startAngle);
            const x2 = cx + radius * Math.cos(endAngle);
            const y2 = cy + radius * Math.sin(endAngle);

            const largeArcFlag = angle > Math.PI ? 1 : 0;

            const pathData = `
                M ${cx} ${cy}
                L ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}
                Z
            `;

            svg += `
                <path d="${pathData}" fill="${seg.color}" stroke="#ffffff" stroke-width="1"/>
            `;

            // ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙˆØ± + Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø·Ø§Ø¹
            const midAngle = startAngle + angle / 2;
            const labelRadius = radius * 0.65;
            const lx = cx + labelRadius * Math.cos(midAngle);
            const ly = cy + labelRadius * Math.sin(midAngle);

            svg += `
                <text x="${lx}" y="${ly - 6}" font-size="11" font-weight="600" text-anchor="middle">
                    ${seg.pivot}
                </text>
                <text x="${lx}" y="${ly + 8}" font-size="10" fill="#333" text-anchor="middle">
                    (${seg.performance})
                </text>
            `;

            currentAngle = endAngle;
        });

        // ÙˆØ³ÙŠÙ„Ø© Ø¥ÙŠØ¶Ø§Ø­ (Legend) Ø¨Ø¯ÙˆÙ† Ù†Ø³Ø¨ ÙˆÙ„Ø§ Ø£Ø¹Ø¯Ø§Ø¯
        let legendY = 60;
        segments.forEach((seg, index) => {
            const legendX = 20;
            svg += `
                <rect x="${legendX}" y="${legendY}" width="14" height="14" fill="${seg.color}" stroke="#444" stroke-width="0.5"/>
                <text x="${legendX + 20}" y="${legendY + 11}" font-size="11">
                    ${index + 1} - ${seg.pivot} (${seg.performance})
                </text>
            `;
            legendY += 18;
        });

        svg += `</svg>`;
        return svg;
    }

    function buildStatsChart() {
        const svg = getStatsSVG();
        if (!svg) {
            statsChart.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ. ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ£Ù…Ù„ Ø£ÙˆÙ„Ù‹Ø§.</p>";
        } else {
            statsChart.innerHTML = svg;
        }
    }

    // ---------------- Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ùˆ PDF ----------------

    function buildReportPages() {
        reportPagesContainer.innerHTML = "";

        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
        const globalTotals = { "Ø¯Ø§Ø¦Ù…Ù‹Ø§": 0, "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§": 0, "Ø£Ø¨Ø¯Ù‹Ø§": 0 };
        const perPivotData = [];

        pivotOrder.forEach(pivot => {
            const result = computePivotStats(pivot);
            const { stats, rows, total, performance, percentAlways } = result;

            globalTotals["Ø¯Ø§Ø¦Ù…Ù‹Ø§"] += stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"];
            globalTotals["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"] += stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"];
            globalTotals["Ø£Ø¨Ø¯Ù‹Ø§"]   += stats["Ø£Ø¨Ø¯Ù‹Ø§"];

            perPivotData.push({
                pivot,
                stats,
                rows,
                total,
                performance,
                percentAlways
            });
        });

        // ØµÙØ­Ø© 1: Ø¨ÙŠØ§Ù†Ø§Øª + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© + Ø§Ù„Ø±Ø³Ù…
        const page1 = document.createElement("div");
        page1.className = "report-page";

        const statsSVG = getStatsSVG();
        const chartSection = statsSVG
            ? `
            <div class="report-section-title">Ù…Ø®Ø·Ø· Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ù„Ù…Ø­Ø§ÙˆØ±</div>
            <div style="text-align:center; margin-top:10px;">
                ${statsSVG}
            </div>
        `
            : "";

        page1.innerHTML = `
            <div class="report-header">
                <img src="https://raw.githubusercontent.com/msroh8/app/main/headr.jpg" alt="Ø´Ø¹Ø§Ø±" crossorigin="anonymous">
                <div class="report-title">Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ â€“ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</div>
            </div>

            <div class="report-section-title">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            <table class="report-table">
                <tr><th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</th><td>${localStorage.getItem("edara")   || "â€”"}</td></tr>
                <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th><td>${localStorage.getItem("school")  || "â€”"}</td></tr>
                <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th><td>${localStorage.getItem("teacher") || "â€”"}</td></tr>
                <tr><th>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th><td>${localStorage.getItem("manager") || "â€”"}</td></tr>
            </table>

            <div class="report-section-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ£Ù…Ù„</div>
            <p class="report-stat-line">Ø¹Ø¯Ø¯ "Ø¯Ø§Ø¦Ù…Ù‹Ø§": ${globalTotals["Ø¯Ø§Ø¦Ù…Ù‹Ø§"]}</p>
            <p class="report-stat-line">Ø¹Ø¯Ø¯ "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§": ${globalTotals["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"]}</p>
            <p class="report-stat-line">Ø¹Ø¯Ø¯ "Ø£Ø¨Ø¯Ù‹Ø§": ${globalTotals["Ø£Ø¨Ø¯Ù‹Ø§"]}</p>
            ${chartSection}
        `;
        reportPagesContainer.appendChild(page1);

        // ØµÙØ­Ø© Ù„ÙƒÙ„ Ù…Ø­ÙˆØ±
        perPivotData.forEach(({ pivot, stats, rows, total, performance, percentAlways }) => {
            const page = document.createElement("div");
            page.className = "report-page";

            let rowsHtml = "";
            rows.forEach((r, idx) => {
                rowsHtml += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${r.text}</td>
                        <td>${r.value}</td>
                        <td>${r.comment}</td>
                    </tr>
                `;
            });

            const totalText = total > 0
                ? `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø¬Ø§Ø¨Ø©: ${total} / Ù†Ø³Ø¨Ø© "Ø¯Ø§Ø¦Ù…Ù‹Ø§": ${percentAlways.toFixed(1)}%`
                : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ÙˆØ±.";

            page.innerHTML = `
                <div class="report-header">
                    <img src="https://raw.githubusercontent.com/msroh8/app/main/headr.jpg" alt="Ø´Ø¹Ø§Ø±" crossorigin="anonymous">
                    <div class="report-title">Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ â€“ Ù…Ø­ÙˆØ±: ${pivot}</div>
                </div>

                <div class="report-section-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙˆØ±</div>
                <p class="report-stat-line">
                    Ø¯Ø§Ø¦Ù…Ù‹Ø§: ${stats["Ø¯Ø§Ø¦Ù…Ù‹Ø§"]} | Ø£Ø­ÙŠØ§Ù†Ù‹Ø§: ${stats["Ø£Ø­ÙŠØ§Ù†Ù‹Ø§"]} | Ø£Ø¨Ø¯Ù‹Ø§: ${stats["Ø£Ø¨Ø¯Ù‹Ø§"]}
                </p>
                <p class="report-stat-line">
                    Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø­ÙˆØ±: <b>${performance}</b> (${totalText})
                </p>

                <div class="report-section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯</div>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Ù…</th>
                            <th>Ø§Ù„Ø¨Ù†Ø¯</th>
                            <th>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</th>
                            <th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rowsHtml}
                    </tbody>
                </table>
            `;
            reportPagesContainer.appendChild(page);
        });

        // ØµÙØ­Ø© SWOT
        const swotPage = document.createElement("div");
        swotPage.className = "report-page";

        const swotData = {
            "Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© (Strengths)": JSON.parse(localStorage.getItem("swot_strength")   || "[]"),
            "Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù (Weaknesses)": JSON.parse(localStorage.getItem("swot_weakness") || "[]"),
            "Ø§Ù„ÙØ±Øµ (Opportunities)":   JSON.parse(localStorage.getItem("swot_opportunity") || "[]"),
            "Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª (Threats)":     JSON.parse(localStorage.getItem("swot_threat")    || "[]")
        };

        let swotHtml = "";
        Object.keys(swotData).forEach(title => {
            const list = swotData[title];
            let itemsHtml = "";
            list.forEach((item, idx) => {
                itemsHtml += `<tr><td>${idx + 1}</td><td>${item}</td></tr>`;
            });

            swotHtml += `
                <div class="report-section-title">${title}</div>
                <table class="report-table" style="margin-bottom:10px;">
                    <thead>
                        <tr><th>Ù…</th><th>Ø§Ù„Ø¨Ù†Ø¯</th></tr>
                    </thead>
                    <tbody>
                        ${itemsHtml || '<tr><td colspan="2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ù…Ø¯Ø®Ù„Ø©.</td></tr>'}
                    </tbody>
                </table>
            `;
        });

        swotPage.innerHTML = `
            <div class="report-header">
                <img src="https://raw.githubusercontent.com/msroh8/app/main/headr.jpg" alt="Ø´Ø¹Ø§Ø±" crossorigin="anonymous">
                <div class="report-title">Ø§Ù„ØªØ£Ù…Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ â€“ ØªØ­Ù„ÙŠÙ„ SWOT</div>
            </div>
            ${swotHtml}
        `;
        reportPagesContainer.appendChild(swotPage);
    }

    // ØªÙˆÙ„ÙŠØ¯ PDF
    async function generatePDF() {
        buildReportPages();

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'pt', 'a4');
        const pages = document.querySelectorAll(".report-page");

        for (let i = 0; i < pages.length; i++) {
            const page = pages[i];
            const canvas = await html2canvas(page, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL("image/png");

            const imgWidth  = pdf.internal.pageSize.getWidth();
            const imgHeight = canvas.height * imgWidth / canvas.width;

            if (i > 0) pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        }

        pdf.save("Ø§Ù„ØªØ£Ù…Ù„_Ø§Ù„Ù…Ù‡Ù†ÙŠ.pdf");
    }

    btnGeneratePDF.onclick = () => {
        generatePDF();
    };
</script>

</body>
</html>
