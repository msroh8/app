<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฃุฏุงุฉ ูุชุงุจุนุฉ ููุงุฑุณุงุช ุงูุชุฏุฑูุณ</title>
    <!-- ุชุญููู Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ุฎุท Noto Kufi Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Kufi+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Kufi Arabic', 'Inter', sans-serif;
        }
        
        /* ุฅุฎูุงุก ุงููุญุชูู ุงููุงุจู ููุทู */
        .collapsible-content {
            display: none;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.active {
            display: block;
        }

        /* ุฃุณูู ุงูุฃููุฑุฏููู */
        .chevron-icon {
            transition: transform 0.3s ease;
        }
        .active .chevron-icon {
            transform: rotate(180deg);
        }

        /* ุฃููููุงุช ุงูุญุงูุฉ */
        .status-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        .status-icon.selected {
            border-color: #3b82f6; /* A blue border when selected */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        /* ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 24px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            animation: slideIn 0.3s ease;
            position: relative;
        }
        
        .modal-close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            left: 20px;
            top: 10px;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: black;
            text-decoration: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ุฒุฑ ุญุฐู ุงููุฑูู */
        .delete-attachment {
            color: #ef4444; /* red-500 */
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
        }
        .delete-attachment:hover {
            color: #dc2626; /* red-600 */
        }
        
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <!-- ุงูุญุงููุฉ ุงูุฑุฆูุณูุฉ -->
    <div class="">
        <!-- ุงูููุฏุฑ -->
        <header class="mb-8 flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-xl shadow-md">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ุฃุฏุงุฉ ูุชุงุจุนุฉ ููุงุฑุณุงุช ุงูุชุฏุฑูุณ</h1>
                <p class="text-gray-600 mt-1">ุตูุญุฉ ุชูุงุนููุฉ ูุชุชุจุน ุงูุดูุงูุฏ ูุฅุถุงูุฉ ุงูุฑูุงุจุท ุจูุงุกู ุนูู ุงูุฅุทุงุฑ ุงููุนุชูุฏ.</p>
            </div>
            <!-- *** ูุฌููุนุฉ ุงูุฃุฒุฑุงุฑ *** -->
            <div class="flex flex-col md:flex-row gap-2 mt-4 md:mt-0">
                <button onclick="exportReport()" class="w-full md:w-auto bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-green-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                    ุชุตุฏูุฑ ุงูุชูุฑูุฑ
                </button>
                <button onclick="exportData()" class="w-full md:w-auto bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    ุชุตุฏูุฑ ุงูุจูุงูุงุช
                </button>
                <!-- ุฒุฑ ุงูุงุณุชูุฑุงุฏ ุงููุฎูู -->
                <input type="file" id="import-file-input" accept=".json" class="hidden" onchange="importData(event)">
                <button onclick="document.getElementById('import-file-input').click()" class="w-full md:w-auto bg-yellow-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition duration-300">
                    ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
                </button>
                <button onclick="clearData()" class="w-full md:w-auto bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition duration-300">
                    ูุณุญ ูู ุงูุจูุงูุงุช
                </button>
            </div>
        </header>

        <!-- ุญุงููุฉ ุงููุฎุทุท -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

            <!-- ุงูุนููุฏ 1: ุงููุฌุงู ุงูุฅุดุฑุงูู -->
            <div class="flex flex-col gap-6">
                <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                    <h2 class="text-xl font-bold text-white bg-teal-600 p-3 rounded-lg -mt-8 mx-4 text-center shadow-lg">ุงููุฌุงู ุงูุฅุดุฑุงูู</h2>
                    <div class="mt-6 p-4 bg-teal-50 text-teal-800 rounded-lg text-center">
                        <span class="text-lg font-semibold">ุงูุชุฏุฑูุณ</span>
                    </div>
                </div>
            </div>

            <!-- ุงูุนููุฏ 2: ุงูุฅุทุงุฑ -->
            <div class="flex flex-col gap-6">
                <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                    <h2 class="text-xl font-bold text-white bg-blue-600 p-3 rounded-lg -mt-8 mx-4 text-center shadow-lg">ุงูุฅุทุงุฑ</h2>
                    <div class="mt-6 space-y-3">
                        <div class="p-3 bg-blue-50 text-blue-800 rounded-lg text-center font-medium">ุชุฎุทูุท ุงูุชุฏุฑูุณ</div>
                        <div class="p-3 bg-blue-50 text-blue-800 rounded-lg text-center font-medium">ุชูููุฐ ุงูุชุฏุฑูุณ</div>
                        <div class="p-3 bg-blue-50 text-blue-800 rounded-lg text-center font-medium">ุชูููู ุงูุชุนูู</div>
                    </div>
                </div>
            </div>

            <!-- ุงูุนููุฏ 3: ููุฌูุงุช -->
            <div class="flex flex-col gap-6">
                <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                    <h2 class="text-xl font-bold text-white bg-green-500 p-3 rounded-lg -mt-8 mx-4 text-center shadow-lg">ููุฌูุงุช</h2>
                    <ul class="mt-6 space-y-3 list-disc list-inside pr-2 text-green-800">
                        <li class="p-2 bg-green-50 rounded-md">ุชุฎุทูุท ุงููุญุฏุงุช ูุงููุตูู ูุงูุฏุฑูุณ.</li>
                        <li class="p-2 bg-green-50 rounded-md">ุทุฑุงุฆู ุงูุชุฏุฑูุณ ูุฃุณุงููุจู.</li>
                        <li class="p-2 bg-green-50 rounded-md">ุงูุชูููุงุช ูุงููุณุงุฆู ุงูุชุนููููุฉ.</li>
                        <li class="p-2 bg-green-50 rounded-md">ุงูุชุฎุทูุท ููุชูููู ูุฅุนุฏุงุฏ ุฃุฏูุงุชู.</li>
                    </ul>
                </div>
            </div>

            <!-- ุงูุนููุฏ 4: ุงูุฃุฏูุงุช ูุงูุทุฑู ูุงูุฃุณุงููุจ (ุชูุงุนูู) -->
            <div class="md:col-span-4 lg:col-span-1 flex flex-col gap-6">
                <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                    <!-- ุงูุนููุงู ูุน ุฃููููุฉ ุงููุนูููุงุช -->
                    <div class="flex justify-center items-center -mt-8 mx-4">
                        <h2 class="text-xl font-bold text-white bg-amber-600 p-3 rounded-lg text-center shadow-lg flex-grow">ุงูุฃุฏูุงุช ูุงูุทุฑู ูุงูุฃุณุงููุจ</h2>
                    </div>
                    
                    <div class="mt-6 space-y-3 max-h-[80vh] overflow-y-auto pr-2" id="practices-list">
                        <!-- ุณูุชู ุฅุฏุฑุงุฌ ุงูุนูุงุตุฑ ููุง ุจุงุณุชุฎุฏุงู ุฌุงูุงุณูุฑุจุช -->
                    </div>
                </div>
            </div>

        </div> <!-- ููุงูุฉ ุญุงููุฉ ุงููุฎุทุท -->
    </div> <!-- ููุงูุฉ ุงูุญุงููุฉ ุงูุฑุฆูุณูุฉ -->

    <!-- ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) ููุดูุงูุฏ -->
    <div id="info-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="modal-close-button">&times;</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-4" id="modal-title">ุดูุงูุฏ ููุชุฑุญุฉ</h2>
            <div class="space-y-3 text-gray-700" id="modal-body">
                <!-- ุณูุชู ุญูู ุงููุญุชูู ููุง ุจูุงุณุทุฉ ุฌุงูุงุณูุฑุจุช -->
            </div>
        </div>
    </div>

    <!-- ุงูููุชุฑ -->
    <footer class="text-center mt-8 mb-4">
        <p class="text-xs text-gray-500">ููุฑุฉ ูุชูููุฐ ูุญูุฏ ูุฌููู</p>
    </footer>


    <script>
        // ูุงุฆูุฉ ุงูููุงุฑุณุงุช ุงููุญุฏุซุฉ ูู ุงูุตูุฑุฉ
        const practices = [
            "ุชุฃุณูุณ ุชููุนุงุช ุฃุฏุงุก ุนุงููุฉ ูููุชุนูููู.",
            "ุฅุนุฏุงุฏ ุฎุทุท ุงูุฏุฑูุณ ูุชุตููู ุฃูุดุทุฉ ุงูุชุนูู.",
            "ุชุตููู ุจุฑุงูุฌ ุชุนูู ููู ุฎุทุฉ ุงูุฏุฑุณ.",
            "ุงูุชูููุน ูู ุงุณุชุฎุฏุงู ุทุฑุงุฆู ุงูุชุฏุฑูุณ ูุฃุณุงููุจู ูุงุณุชุฑุงุชูุฌูุงุชู.",
            "ุฏูุฌ ุงููุณุงุฆู ุงูุชูููุฉ ุถูู ุฎุทุฉ ุงูุฏุฑุณ.",
            "ููุงุฏุฉ ุงูุฃูุดุทุฉ ุงูุตููุฉ ุจูุงุนููุฉ.",
            "ุชููุฆุฉ ุจูุฆุงุช ุชุนูู ุขููุฉ ูุฌุงุฐุจุฉ ููุชุนูู.",
            "ุงุณุชุซูุงุฑ ููุช ุงูุชุฏุฑูุณ ุจูุงุนููุฉ.",
            "ุชุทุจูู ุฃุณุงููุจ ุงูุชูููู ูุฃุฏูุงุชู ุงูููุงุณุจุฉ.",
            "ุชูุธูู ูุชุงุฆุฌ ุงูุชูููู ุงูุตูู ูุงูุชูููู ูุงุณุน ุงููุทุงู ูู ุชุญุณูู ุงูุชุฏุฑูุณ ูุงูุชุนูู.",
            "ุชุนุฒูุฒ ุซูุงูุฉ ุงูุชุฏุฑูุณ ุงููุนุงู ูู ุงููุฌุชูุน ุงููุฏุฑุณู."
        ];

        // ุดูุงูุฏ ููุชุฑุญุฉ ููู ููุงุฑุณุฉ
        const evidenceExamples = {
            "practice-0": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ููุงุฆุญุฉ ุชููุนุงุช ุงูุฃุฏุงุก ูุนููุฉ ูู ุงูุตู.</li><li>ุฑุงุจุท ูููุทุน ููุฏูู ูุตูุฑ ูููุงุด ุงูุชููุนุงุช ูุน ุงูุทูุงุจ.</li><li>ุฑุงุจุท ููููุฐุฌ ูู ูุฑูุฉ ุนูู ุชูุถุญ ุงูุชููุนุงุช.</li></ul>",
            "practice-1": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ููุณุฎุฉ ูู ุฎุทุฉ ุฏุฑุณ.</li><li>ุฑุงุจุท ูููุงุฐุฌ ูู ุฃูุดุทุฉ ุชุนูู ูุตููุฉ (ูุฑููุฉ ุฃู ุฑูููุฉ).</li><li>ุฑุงุจุท ูุตูุฑุฉ ูู ุฏูุชุฑ ุงูุชุญุถูุฑ.</li></ul>",
            "practice-2": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูููู ุจุฑูุงูุฌ ุงูุชุนูู.</li><li>ุฑุงุจุท ูุฎุทุฉ ุงูุฏุฑุณ ุงููุนุจุฃุฉ ุงูุชู ุชูุถุญ ุงูุจุฑูุงูุฌ.</li></ul>",
            "practice-3": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูููุฏูู ูุตูุฑ (ุฃูู ูู ุฏูููุฉ) ููุถุญ ุงุณุชุฎุฏุงู ุงุณุชุฑุงุชูุฌูุฉ ูุนููุฉ.</li><li>ุฑุงุจุท ูุตูุฑ ูุฃูุดุทุฉ ูุชููุนุฉ (ุนูู ูุฑุฏูุ ุฌูุงุนูุ ...).</li><li>ุฑุงุจุท ูุฎุทุฉ ุฏุฑุณ ุชุฐูุฑ ุงูุงุณุชุฑุงุชูุฌูุงุช ุงููููุนุฉ.</li></ul>",
            "practice-4": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ููุดุงุท ุฑููู ุชู ุงุณุชุฎุฏุงูู.</li><li>ุฑุงุจุท ูุตูุฑุฉ ูู ุงูุญุตุฉ ุชุธูุฑ ุงุณุชุฎุฏุงู ุงูุทูุงุจ ููุชูููุฉ.</li><li>ุฑุงุจุท ูุฎุทุฉ ุงูุฏุฑุณ ุงูุชู ุชุดูุฑ ุฅูู ุฏูุฌ ุงูุชูููุฉ.</li></ul>",
            "practice-5": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูููุฏูู ูุตูุฑ ููุถุญ ุฅุฏุงุฑุฉ ุงููุนูู ููุดุงุท ุตูู.</li><li>ุฑุงุจุท ูุตูุฑ ูู ูุฎุฑุฌุงุช ุนูู ุงูุทูุงุจ ูู ุงููุดุงุท.</li></ul>",
            "practice-6": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูุตูุฑ ููุจูุฆุฉ ุงูุตููุฉ (ุชูุธูู ุงูููุงุนุฏุ ููุญุงุช ุงูุนุฑุถ).</li><li>ุฑุงุจุท ูููุทุน ุตูุชู ูููุงูุดุฉ ุตููุฉ ูุณูุฏูุง ุงูุงุญุชุฑุงู.</li></ul>",
            "practice-7": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูุฌุฏูู ุงูุญุตุฉ ููุถุญุงู ุงุณุชุบูุงู ุงูููุช.</li><li>ุฑุงุจุท ูููุฏูู ูุธูุฑ ุงูุชูุงู ุณูุณ ุจูู ุงูุฃูุดุทุฉ.</li></ul>",
            "practice-8": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูููุงุฐุฌ ูู ุฃุฏูุงุช ุงูุชูููู (ุงุฎุชุจุงุฑ ูุตูุฑุ ุณูู ุชูุฏูุฑุ ...).</li><li>ุฑุงุจุท ูุตูุฑุฉ ูุณุคุงู ุชููููู ุนูู ุงูุณุจูุฑุฉ.</li></ul>",
            "practice-9": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ูููุงุฐุฌ ูู ุชุบุฐูุฉ ุฑุงุฌุนุฉ ูุตุญุญุฉ ููุทูุงุจ.</li><li>ุฑุงุจุท ูุฎุทุฉ ูุชุญุณูู ุงูุชุฏุฑูุณ ุจูุงุก ุนูู ูุชุงุฆุฌ ุงูุชูููู.</li><li>ุฑุงุจุท ูููู ุฎุทุท ุนูุงุฌูุฉ.</li></ul>",
            "practice-10": "<strong>ุดูุงูุฏ ููุชุฑุญุฉ:</strong><ul class='list-disc pr-6'><li>ุฑุงุจุท ููุญุถุฑ ุงุฌุชูุงุน ูุน ุงูุฒููุงุก ูููุงูุดุฉ ุงูููุงุฑุณุงุช.</li><li>ุฑุงุจุท ูุตูุฑุฉ ูู ูุฑุดุฉ ุนูู ุฏุงุฎููุฉ.</li><li>ุฑุงุจุท ูููุฑุฏ ุชุนูููู ุชูุช ูุดุงุฑูุชู.</li></ul>"
        };

        // ุฏุงูุฉ ูุณุงุนุฏุฉ ูุฌูุจ ููู ุงูุญุงูุฉ
        function getStatusColorClass(status) {
            if (status === 'ููุชูู') return 'text-green-600';
            if (status === 'ููุฏ ุงูุชูููุฐ') return 'text-yellow-600';
            return 'text-gray-600';
        }

        // ุชุญููู ุงูุจูุงูุงุช ูู LocalStorage ุฃู ุงุณุชุฎุฏุงู ูุงุฆู ูุงุฑุบ
        let practicesData = JSON.parse(localStorage.getItem('practicesData')) || {};

        const practicesListContainer = document.getElementById('practices-list');

        // --- ุฏุงูุฉ ูุนุฑุถ ูุงุฆูุฉ ุงูุฑูุงุจุท ---
        function renderFileList(id) {
            const fileListEl = document.getElementById(`file-list-${id}`);
            fileListEl.innerHTML = ''; // ูุณุญ ุงููุงุฆูุฉ ุงูุญุงููุฉ

            if (!practicesData[id] || !practicesData[id].files) {
                return;
            }

            practicesData[id].files.forEach((file, index) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center text-sm bg-gray-100 p-2 rounded-md';
                
                let content = '';
                if (file.type === 'link') {
                    content = `
                        <a href="${file.data}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline overflow-hidden whitespace-nowrap text-ellipsis" title="${file.data}">
                            ๐ ${file.name}
                        </a>
                    `;
                }
                
                li.innerHTML = `
                    <span class="flex-1 overflow-hidden">${content}</span>
                    <button type="button" class="delete-attachment" data-id="${id}" data-index="${index}" title="ุญุฐู ุงูุฑุงุจุท">&times;</button>
                `;
                fileListEl.appendChild(li);
            });

            // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูุฃุฒุฑุงุฑ ุงูุญุฐู
            fileListEl.querySelectorAll('.delete-attachment').forEach(button => {
                button.addEventListener('click', () => {
                    const dataId = button.dataset.id;
                    const dataIndex = parseInt(button.dataset.index, 10);
                    deleteAttachment(dataId, dataIndex);
                });
            });

            // ุฅูุบุงุก ุงูุญุฏ ุงูุฃูุตู ููุฑูุงุจุท
            const addButton = document.querySelector(`#${id} button[onclick="addLink('${id}')"]`);
            if (addButton) {
                addButton.disabled = false;
                addButton.classList.remove("opacity-50", "cursor-not-allowed");
            }
        }
        
        // --- ุฏุงูุฉ ูุญุฐู ูุฑูู (ุฑุงุจุท) ---
        function deleteAttachment(id, index) {
            if (practicesData[id] && practicesData[id].files) {
                practicesData[id].files.splice(index, 1); // ุญุฐู ุงูุนูุตุฑ ูู ุงููุตูููุฉ
                saveToLocalStorage(); // ุญูุธ ุงูุชุบููุฑุงุช
                renderFileList(id); // ุฅุนุงุฏุฉ ุนุฑุถ ุงููุงุฆูุฉ
            }
        }

        // ุฅูุดุงุก ุงูุจุทุงูุงุช ุงูุชูุงุนููุฉ
        practices.forEach((practice, index) => {
            const id = `practice-${index}`;
            
            // ุชููุฆุฉ ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ ูู LocalStorage
            if (!practicesData[id]) {
                practicesData[id] = {
                    title: practice,
                    status: "ูู ูุจุฏุฃ", // "ูู ูุจุฏุฃ", "ููุฏ ุงูุชูููุฐ", "ููุชูู"
                    evidence: "",
                    executor: "", // ุฅุถุงูุฉ ุญูู ูุณุคูู ุงูุชูููุฐ
                    files: [] // ุณุชุฎุฒู ุงูุฑูุงุจุท { type: 'link', name: '...', data: '...' }
                };
            }
            
            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูุญูู ุงูุฌุฏูุฏ ูู ุงูุจูุงูุงุช ุงููุฏููุฉ
            if (typeof practicesData[id].executor === 'undefined') {
                practicesData[id].executor = "";
            }


            const item = practicesData[id];
            const initialStatusColor = getStatusColorClass(item.status); // Get initial color

            const itemHtml = `
                <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg shadow-sm mb-3">
                    <!-- ุฑุฃุณ ุงูุจุทุงูุฉ ุงููุงุจู ููุถุบุท -->
                    <div class="flex justify-between items-center">
                        <!-- Clickable Title Area (Toggle) -->
                        <div class="flex-1 flex justify-between items-center cursor-pointer accordion-toggle" data-target="${id}">
                            <h4 class="font-semibold text-gray-800 flex-1">${item.title}</h4>
                            <svg class="chevron-icon w-5 h-5 text-gray-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <!-- Info button -->
                        <button class="practice-info-button text-blue-500 hover:text-blue-700 mr-2 p-1" data-id="${id}" title="ุนุฑุถ ุงูุดูุงูุฏ ุงูููุชุฑุญุฉ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- ุงููุญุชูู ุงููุงุจู ููุทู -->
                    <div id="${id}" class="collapsible-content mt-4 border-t border-gray-200 pt-4">
                        <!-- ุฃููููุงุช ุงูุญุงูุฉ -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-sm font-medium text-gray-700">ุญุงูุฉ ุงูุชูููุฐ:</label>
                                <span id="status-text-${id}" class="text-sm font-semibold ${initialStatusColor}">${item.status}</span>
                            </div>
                            <div class="flex space-x-2" dir="ltr">
                                <!-- ูู ูุจุฏุฃ -->
                                <span class="status-icon bg-gray-300 hover:bg-gray-400 ${item.status === 'ูู ูุจุฏุฃ' ? 'selected' : ''}" data-status="ูู ูุจุฏุฃ" data-id="${id}" title="ูู ูุจุฏุฃ">
                                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </span>
                                <!-- ููุฏ ุงูุชูููุฐ -->
                                <span class="status-icon bg-yellow-300 hover:bg-yellow-400 ${item.status === 'ููุฏ ุงูุชูููุฐ' ? 'selected' : ''}" data-status="ููุฏ ุงูุชูููุฐ" data-id="${id}" title="ููุฏ ุงูุชูููุฐ">
                                    <svg class="w-5 h-5 text-yellow-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </span>
                                <!-- ููุชูู -->
                                <span class="status-icon bg-green-400 hover:bg-green-500 ${item.status === 'ููุชูู' ? 'selected' : ''}" data-status="ููุชูู" data-id="${id}" title="ููุชูู">
                                    <svg class="w-5 h-5 text-green-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </span>
                            </div>
                        </div>
                        
                        <!-- ุงูุดูุงูุฏ ูุงูููุงุญุธุงุช -->
                        <div class="mt-4">
                            <label for="evidence-${id}" class="block text-sm font-medium text-gray-700 mb-1">ุงูุดูุงูุฏ ูุงูููุงุญุธุงุช</label>
                            <textarea id="evidence-${id}" rows="3" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="ุงูุชุจ ููุงุญุธุงุชู ููุง..." oninput="updateData('${id}', 'evidence', this.value)">${item.evidence}</textarea>
                        </div>

                        <!-- ุฅุถุงูุฉ ุญูู ูุณุคูู ุงูุชูููุฐ -->
                        <div class="mt-4">
                            <label for="executor-${id}" class="block text-sm font-medium text-gray-700 mb-1">ูุณุคูู ุงูุชูููุฐ</label>
                            <input type="text" id="executor-${id}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="ุงูุชุจ ุงุณู ุงููุณุคูู ููุง..." value="${item.executor || ''}" oninput="updateData('${id}', 'executor', this.value)">
                        </div>
                        
                        <!-- ุฅุถุงูุฉ ุฑุงุจุท -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">ุฅุถุงูุฉ ุฑุงุจุท ูุดุงูุฏ</label>
                            <div class="flex gap-2">
                                <button type="button" class="w-full bg-blue-50 text-blue-700 font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-blue-100 transition duration-300" onclick="addLink('${id}')">
                                    ๐ ุฅุถุงูุฉ ุฑุงุจุท...
                                </button>
                            </div>
                            <ul id="file-list-${id}" class="mt-3 space-y-2">
                                <!-- ุงูุฑูุงุจุท ุณุชุถุงู ููุง -->
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            practicesListContainer.innerHTML += itemHtml;
            // ุนุฑุถ ุงูุฑูุงุจุท ุงููุญููุธุฉ ุนูุฏ ุงูุชุญููู
            renderFileList(id);
        });

        // --- ุฏูุงู ุญูุธ ูุชุญุฏูุซ ุงูุจูุงูุงุช ---

        // ุฏุงูุฉ ูุญูุธ ุฌููุน ุงูุจูุงูุงุช ูู LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('practicesData', JSON.stringify(practicesData));
        }

        // ุฏุงูุฉ ูุชุญุฏูุซ ูููุฉ ูุนููุฉ ูู ุงูุจูุงูุงุช
        function updateData(id, key, value) {
            if (practicesData[id]) {
                practicesData[id][key] = value;
                saveToLocalStorage();
            }
        }
        
        // --- ุฏุงูุฉ ุฅุถุงูุฉ ุฑุงุจุท ---
        function addLink(id) {
            const url = prompt("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุฑุงุจุท (ูุซุงู: https://www.example.com):");
            if (url) {
                let name = prompt("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ูุตูู ููุฑุงุจุท (ุงุฎุชูุงุฑู):");
                name = name || url; // ุฅุฐุง ูู ูุฏุฎู ุงุณูุ ุงุณุชุฎุฏู ุงูุฑุงุจุท ููุณู ูุงุณู

                if (!practicesData[id].files) {
                    practicesData[id].files = [];
                }
                
                practicesData[id].files.push({
                    type: 'link',
                    name: name,
                    data: url
                });
                
                saveToLocalStorage();
                renderFileList(id); // ุฅุนุงุฏุฉ ุนุฑุถ ุงููุงุฆูุฉ
            }
        }


        // --- ูุณุชูุนู ุงูุฃุญุฏุงุซ ---

        // ูุชุญ ูุฅุบูุงู ุงูุฃููุฑุฏููู
        document.querySelectorAll('.accordion-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                const content = document.getElementById(targetId);
                button.classList.toggle('active');
                content.classList.toggle('active');
                
                if (content.classList.contains('active')) {
                    content.style.maxHeight = content.scrollHeight + "px";
                } else {
                    content.style.maxHeight = null;
                }
            });
        });

        // ุชุบููุฑ ุงูุญุงูุฉ ุนุจุฑ ุงูุฃููููุงุช
        document.querySelectorAll('.status-icon').forEach(icon => {
            icon.addEventListener('click', () => {
                const id = icon.dataset.id;
                const newStatus = icon.dataset.status;
                
                // ุชุญุฏูุซ ุงูุจูุงูุงุช
                updateData(id, 'status', newStatus);
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ (ุฅุฒุงูุฉ 'selected' ูู ุงููู ูุฅุถุงูุชูุง ูููุถุบูุท)
                document.querySelectorAll(`.status-icon[data-id="${id}"]`).forEach(i => i.classList.remove('selected'));
                icon.classList.add('selected');

                // ุชุญุฏูุซ ุงููุต ุงููููู ููุญุงูุฉ
                const statusTextElement = document.getElementById(`status-text-${id}`);
                statusTextElement.textContent = newStatus;
                statusTextElement.className = `text-sm font-semibold ${getStatusColorClass(newStatus)}`;
            });
        });
        
        // --- ุฏูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) ---
        const modal = document.getElementById('info-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalClose = document.getElementById('modal-close-button');

        // ุฏุงูุฉ ูุนุฑุถ ุฑุณุงูุฉ ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
        function showModalMessage(title, message) {
            modalTitle.textContent = title;
            modalBody.innerHTML = message;
            modal.style.display = "block";
        }

        // ูุชุญ ุงููุงูุฐุฉ ุนูุฏ ุงูุถุบุท ุนูู ุฃููููุฉ ุงููุนูููุงุช
        document.querySelectorAll('.practice-info-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // ููุน ูุชุญ ุงูุฃููุฑุฏููู
                const id = button.dataset.id;
                const practiceTitle = practicesData[id].title;
                const evidenceHtml = evidenceExamples[id] || "<p>ูุง ุชูุฌุฏ ุดูุงูุฏ ููุชุฑุญุฉ ุญุงููุงู ููุฐู ุงูููุงุฑุณุฉ.</p>";
                
                showModalMessage(practiceTitle, evidenceHtml);
            });
        });

        // ุฅุบูุงู ุงููุงูุฐุฉ
        modalClose.onclick = () => { modal.style.display = "none"; }
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        
        // --- *** ุฏูุงู ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช (ุชุตุฏูุฑุ ุงุณุชูุฑุงุฏุ ูุณุญ) *** ---

        // 1. ุชุตุฏูุฑ ุงูุจูุงูุงุช (JSON)
        function exportData() {
            try {
                const dataStr = JSON.stringify(practicesData, null, 2); // ุชูุณูู JSON ูุณูููุฉ ุงููุฑุงุกุฉ
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `practices_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showModalMessage("ูุฌุงุญ", "<p>ุชู ุชุตุฏูุฑ ุจูุงูุงุชู ุจูุฌุงุญ ูู ููู JSON.</p>");
            } catch (err) {
                console.error("Error exporting data:", err);
                showModalMessage("ุฎุทุฃ", "<p>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุตุฏูุฑ ุงูุจูุงูุงุช.</p>");
            }
        }

        // 2. ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช (JSON)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    // ุชุญูู ุจุณูุท ููุชุฃูุฏ ุฃูู ูุงุฆู ูููุณ ูุตูููุฉ ุฃู ูุต ุนุงุฏู
                    if (typeof importedData === 'object' && importedData !== null && !Array.isArray(importedData)) {
                        practicesData = importedData;
                        saveToLocalStorage();
                        showModalMessage("ูุฌุงุญ", "<p>ุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ุจูุฌุงุญ. ุณูุชู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุงูุขู.</p>");
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        throw new Error("ุงูููู ุบูุฑ ุตุงูุญ ุฃู ูุง ูุญุชูู ุนูู ูุงุฆู JSON.");
                    }
                } catch (err) {
                    console.error("Error importing data:", err);
                    showModalMessage("ุฎุทุฃ ูู ุงูุงุณุชูุฑุงุฏ", `<p>ูู ูุชููู ูู ูุฑุงุกุฉ ุงูููู. ุชุฃูุฏ ุฃูู ููู JSON ุตุงูุญ ุชู ุชุตุฏูุฑู ูู ูุฐู ุงูุฃุฏุงุฉ.</p><p>ุงูุฎุทุฃ: ${err.message}</p>`);
                }
                // ุฅุนุงุฏุฉ ุชุนููู ุญูู ุงูุฅุฏุฎุงู ููุณูุงุญ ุจุฑูุน ููุณ ุงูููู ูุฑุฉ ุฃุฎุฑู
                event.target.value = null;
            };
            reader.onerror = function() {
                showModalMessage("ุฎุทุฃ", "<p>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุฑุงุกุฉ ุงูููู.</p>");
            };
            reader.readAsText(file);
        }

        // 3. ูุณุญ ูู ุงูุจูุงูุงุช
        function clearData() {
            // ุงุณุชุฎุฏุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ููุชุฃููุฏ
            const confirmationHtml = `
                <p class="mb-4">ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู ูุฐุง ุงููุชุตูุญุ</p>
                <p class="mb-6 text-sm text-red-600">ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.</p>
                <div class="flex justify-end gap-4">
                    <button id="confirm-clear-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">ูุนูุ ุงูุณุญ ุงูุจูุงูุงุช</button>
                    <button id="cancel-clear-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">ุฅูุบุงุก</button>
                </div>
            `;
            showModalMessage("ุชุฃููุฏ ูุณุญ ุงูุจูุงูุงุช", confirmationHtml);

            // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูุฃุฒุฑุงุฑ ุงูุชุฃููุฏ
            document.getElementById('confirm-clear-btn').onclick = () => {
                localStorage.removeItem('practicesData');
                window.location.reload();
            };
            document.getElementById('cancel-clear-btn').onclick = () => {
                modal.style.display = "none";
            };
        }

        // --- ุฏุงูุฉ ุชุตุฏูุฑ ุงูุชูุฑูุฑ (ุชูุชุญ ุตูุญุฉ ุฌุฏูุฏุฉ) ---
        function exportReport() {
            try {
                // ุจูุงุก ูุญุชูู ุงูุชูุฑูุฑ (ุฌุฏูู)
                let reportContent = `
                    <!doctype html>
                    <html lang="ar" dir="rtl">
                    <head>
                        <meta charset="utf-8">
                        <title>ุชูุฑูุฑ ููุงุฑุณุงุช ุงูุชุฏุฑูุณ</title>
                        <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
                        <style>
                            body { 
                                font-family: 'Noto Kufi Arabic', sans-serif; 
                                direction: rtl; 
                                margin: 20px auto; 
                                max-width: 1200px;
                                padding: 0 20px;
                            }
                            h1 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
                            .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            .report-table th, .report-table td { 
                                border: 1px solid #ddd; 
                                padding: 10px; 
                                text-align: right; 
                                vertical-align: top; 
                                word-wrap: break-word; 
                            }
                            .report-table thead { background-color: #f2f2f2; }
                            .status-ูู-ูุจุฏุฃ { color: #888; font-weight: bold; }
                            .status-ููุฏ-ุงูุชูููุฐ { color: #e67e22; font-weight: bold; }
                            .status-ููุชูู { color: #27ae60; font-weight: bold; }
                            .report-attachment-list { list-style-type: none; padding-right: 0; margin: 0; }
                            .report-attachment-list li { margin-bottom: 8px; word-break: break-all; }
                            .report-attachment-link { color:#0056b3; text-decoration:underline; }
                        </style>
                    </head>
                    <body>
                        <h1>ููุฎุต ุชูุฑูุฑ ููุงุฑุณุงุช ุงูุชุฏุฑูุณ</h1>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th style="width: 20%;">ุงูุฃุฏุงุฉ/ุงูููุงุฑุณุฉ</th>
                                    <th style="width: 10%;">ุญุงูุฉ ุงูุชูููุฐ</th>
                                    <th style="width: 25%;">ุงูุดูุงูุฏ ูุงูููุงุญุธุงุช</th>
                                    <th style="width: 20%;">ูุณุคูู ุงูุชูููุฐ</th>
                                    <th style="width: 25%;">ุงูุฑูุงุจุท ุงููุฑููุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                for (const id in practicesData) {
                    const item = practicesData[id] || {};
                    const safeStatusClass = 'status-' + String(item.status || '').replace(/\s+/g, '-');

                    let attachmentsHtml = '<ul class="report-attachment-list">';
                    if (item.files && item.files.length) {
                        item.files.forEach(file => {
                            if (file.type === 'link') {
                                attachmentsHtml += `<li><a href="${file.data}" target="_blank" rel="noopener noreferrer" class="report-attachment-link">${file.name}</a></li>`;
                            }
                        });
                    } else attachmentsHtml += '<li>ูุง ุชูุฌุฏ ุฑูุงุจุท.</li>';
                    attachmentsHtml += '</ul>';

                    // ุฅุตูุงุญ ุฎุทุฃ .replace ูุถูุงู ูุฌูุฏ ุงููุตูุต
                    const evidenceText = String(item.evidence || '').replace(/\n/g, '<br>') || 'ูุง ุชูุฌุฏ ููุงุญุธุงุช.';
                    const executorText = String(item.executor || '').replace(/\n/g, '<br>') || 'ูู ูุญุฏุฏ.'; // ุฅุถุงูุฉ ูุณุคูู ุงูุชูููุฐ ููุชูุฑูุฑ
                    
                    reportContent += `
                        <tr>
                            <td>${item.title || ''}</td>
                            <td><span class="${safeStatusClass}">${item.status || ''}</span></td>
                            <td>${evidenceText}</td>
                            <td>${executorText}</td>
                            <td>${attachmentsHtml}</td>
                        </tr>
                    `;
                }

                reportContent += `
                        </tbody>
                    </table>
                    </body>
                    </html>
                `;

                // ุงุณุชุฎุฏุงู Blob ูุนูู ุตูุญุฉ ูุณุชููุฉ ุจุฏูุงู ูู document.write
                const blob = new Blob([reportContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const reportWindow = window.open(url, '_blank');

                if (!reportWindow || reportWindow.closed || typeof reportWindow.closed == 'undefined') {
                    showModalMessage(
                        "ุฎุทุฃ ูู ุชุตุฏูุฑ ุงูุชูุฑูุฑ",
                        "<p>ูุจุฏู ุฃู ูุชุตูุญู ููุน ูุชุญ ุงูููุงูุฐ. ุงูุฑุฌุงุก ุงูุณูุงุญ ุจุงูููุงูุฐ ุงูููุจุซูุฉ ุซู ุญุงูู ูุฑุฉ ุฃุฎุฑู.</p>"
                    );
                    setTimeout(() => URL.revokeObjectURL(url), 30000); // ุชูุธูู ุงูุฑุงุจุท
                    return;
                }
                
                setTimeout(() => URL.revokeObjectURL(url), 30000); // ุชูุธูู ุงูุฑุงุจุท ุจุนุฏ ูุชุฑุฉ

            } catch (err) {
                console.error("Error exporting report:", err);
                showModalMessage("ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ", `<p>ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุญุงููุฉ ุฅูุดุงุก ุงูุชูุฑูุฑ.</p><p>ุงูุฎุทุฃ: ${err.message}</p>`);
            }
        }
    </script>

</body>
</html>

